<!DOCTYPE html><html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ€ç“¶å·¥ç¨‹å¸ˆ - åˆ›é€ ä½ çš„å¾®å‹ç”Ÿæ€ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .game-container {
            width: 95%;
            max-width: 1600px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 20px;
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 20px;
            min-height: 90vh;
        }

        /* å·¦ä¾§æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }

        .control-section {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .control-section h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ä¸­é—´ç”Ÿæ€ç“¶æ˜¾ç¤ºåŒº */
        .bottle-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .bottle-container {
            position: relative;
            width: 400px;
            height: 500px;
            background: linear-gradient(to bottom, 
                rgba(135, 206, 235, 0.3) 0%, 
                rgba(135, 206, 235, 0.5) 30%,
                rgba(135, 206, 235, 0.7) 100%);
            border: 3px solid #4a90e2;
            border-radius: 20px 20px 50px 50px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .water-surface {
            position: absolute;
            top: 10%;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.6);
            animation: wave 3s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .substrate {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to bottom, #8b7355, #6b5537);
            border-radius: 0 0 47px 47px;
        }

        /* ç”Ÿç‰©å›¾æ ‡æ ·å¼ - æ”¹ä¸ºä½¿ç”¨emoji */
        .organism {
            position: absolute;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.5s ease;
            user-select: none;
            z-index: 10;
        }

        .organism:hover {
            transform: scale(1.2);
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.8));
        }

        /* ä¸åŒç”Ÿç‰©çš„åŠ¨ç”» */
        .plant-organism {
            animation: sway 4s ease-in-out infinite;
        }

        @keyframes sway {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        .fish-organism {
            animation: swim 12s linear infinite;
        }

        @keyframes swim {
            0% { left: -30px; transform: scaleX(1); }
            50% { left: calc(50% - 15px); }
            100% { left: calc(100% + 30px); transform: scaleX(-1); }
        }

        .shrimp-organism {
            animation: hop 8s ease-in-out infinite;
        }

        @keyframes hop {
            0%, 100% { bottom: 70px; }
            25% { bottom: 120px; }
            50% { bottom: 70px; }
            75% { bottom: 100px; }
        }

        .snail-organism {
            animation: crawl 20s linear infinite;
        }

        @keyframes crawl {
            0% { left: 0; bottom: 60px; }
            25% { left: 25%; bottom: 70px; }
            50% { left: 50%; bottom: 60px; }
            75% { left: 75%; bottom: 65px; }
            100% { left: 100%; bottom: 60px; }
        }

        .floating-organism {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(5deg); }
            66% { transform: translateY(10px) rotate(-3deg); }
        }

        .algae {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, 
                rgba(0, 128, 0, 0.1) 0%, 
                transparent 70%);
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.3;
        }

        .bubble {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            animation: rise 5s linear infinite;
        }

        @keyframes rise {
            0% { bottom: 60px; opacity: 0.7; transform: translateX(0); }
            50% { opacity: 0.9; transform: translateX(10px); }
            100% { bottom: 90%; opacity: 0; transform: translateX(-5px); }
        }

        /* å³ä¾§æ•°æ®é¢æ¿ */
        .data-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }

        .parameter {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .parameter-label {
            font-weight: bold;
            color: #34495e;
            margin-bottom: 5px;
        }

        .parameter-value {
            font-size: 24px;
            color: #3498db;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: #3498db;
            transition: width 0.3s ease;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
            font-weight: bold;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        /* ç‰©ç§é€‰æ‹©å™¨ - æ”¹è¿›ç‰ˆ */
        .species-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .species-card {
            padding: 8px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }

        .species-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .species-card.selected {
            border-color: #2ecc71;
            background: #e8f8f5;
        }

        .species-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }

        .species-name {
            font-size: 11px;
            color: #34495e;
            font-weight: bold;
        }

        /* ç‰©ç§ä¿¡æ¯æ˜¾ç¤º */
        .species-info {
            margin-top: 15px;
            padding: 15px;
            background: #e8f6f3;
            border-radius: 10px;
            border: 2px solid #2ecc71;
            display: none;
        }

        .species-info.show {
            display: block;
        }

        .species-title {
            font-size: 16px;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .species-role {
            color: #2c3e50;
            font-size: 14px;
            line-height: 1.4;
        }

        .species-stats {
            margin-top: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 12px;
        }

        .stat-item {
            background: white;
            padding: 5px 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }

        /* ç”Ÿæ€æç¤ºé¢æ¿ */
        .eco-tips {
            margin-top: 15px;
            padding: 15px;
            background: #fff9e6;
            border-radius: 10px;
            border: 2px solid #f39c12;
        }

        .tips-title {
            font-size: 16px;
            font-weight: bold;
            color: #e67e22;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tip-item {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
            font-size: 13px;
            line-height: 1.4;
        }

        .tip-priority {
            font-weight: bold;
            color: #d35400;
        }

        /* æ»‘å—æ ·å¼ */
        .slider-container {
            margin-top: 10px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ecf0f1;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }

        .slider-value {
            text-align: center;
            margin-top: 5px;
            color: #7f8c8d;
            font-size: 14px;
        }

        /* æ—¶é—´æ§åˆ¶ */
        .time-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .speed-indicator {
            padding: 5px 10px;
            background: #ecf0f1;
            border-radius: 5px;
            font-weight: bold;
        }

        /* äº‹ä»¶é€šçŸ¥ */
        .event-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
            z-index: 1000;
        }

        .event-notification.show {
            transform: translateX(0);
        }

        .event-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .event-message {
            color: #7f8c8d;
            font-size: 14px;
        }

        /* æ•™ç¨‹è¦†ç›–å±‚ */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .tutorial-modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .tutorial-modal h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .tutorial-content {
            line-height: 1.6;
            color: #34495e;
        }

        .tutorial-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .tutorial-section h3 {
            color: #3498db;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .tutorial-section ul {
            margin-left: 20px;
        }

        .tutorial-section li {
            margin: 8px 0;
        }

        /* æˆå°±ç³»ç»Ÿ */
        .achievement-popup {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(200px);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.5s ease;
            z-index: 1000;
        }

        .achievement-popup.show {
            transform: translateX(-50%) translateY(0);
        }

        .achievement-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 10px;
        }

        .achievement-title {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
        }

        /* å›¾è¡¨æ ·å¼ */
        .chart-container {
            width: 100%;
            height: 150px;
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        .chart-line {
            stroke: #3498db;
            stroke-width: 2;
            fill: none;
        }

        .chart-grid {
            stroke: #ecf0f1;
            stroke-width: 1;
        }

        /* é£Ÿç‰©é“¾å¯è§†åŒ– */
        .food-chain {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            text-align: center;
        }

        .chain-node {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background: #3498db;
            color: white;
            border-radius: 20px;
            font-size: 14px;
        }

        .chain-arrow {
            display: inline-block;
            margin: 0 10px;
            color: #7f8c8d;
        }

        /* æ¸¸æˆçŠ¶æ€æŒ‡ç¤ºå™¨ */
        .game-status {
            text-align: center;
            padding: 10px;
            background: #2ecc71;
            color: white;
            border-radius: 10px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .game-status.warning {
            background: #f39c12;
        }

        .game-status.danger {
            background: #e74c3c;
        }

        /* å¸®åŠ©æŒ‰é’® */
        .help-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .help-btn:hover {
            transform: scale(1.1);
            background: #2980b9;
        }

        /* æç¤ºå·¥å…· */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 100;
            max-width: 200px;
            line-height: 1.4;
        }

        .tooltip.show {
            opacity: 1;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            flex-direction: column;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: #7f8c8d;
            font-size: 16px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1400px) {
            .game-container {
                grid-template-columns: 300px 1fr 300px;
            }
        }

        @media (max-width: 1200px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                gap: 15px;
            }
            
            .control-panel, .data-panel {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 10px;
            }
            
            .bottle-container {
                width: 350px;
                height: 450px;
            }
        }

        /* æ–°å¢ï¼šè¿›åº¦æç¤ºæ¡ */
        .progress-tip {
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            font-size: 12px;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½ç”»é¢ -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">æ­£åœ¨å‡†å¤‡ä½ çš„ç”Ÿæ€å®éªŒå®¤...</div>
    </div>

    <!-- æ•™ç¨‹è¦†ç›–å±‚ -->
    <div class="tutorial-overlay" id="tutorialOverlay" style="display: none;">
        <div class="tutorial-modal">
            <h2>ğŸŒ¿ æ¬¢è¿æ¥åˆ°ç”Ÿæ€ç“¶å·¥ç¨‹å¸ˆ ğŸŒ¿</h2>
            <div class="tutorial-content">
                <div class="tutorial-section">
                    <h3>ğŸ¯ æ¸¸æˆç›®æ ‡</h3>
                    <p>ä½œä¸ºä¸€åç”Ÿæ€ç“¶å·¥ç¨‹å¸ˆï¼Œä½ çš„ä»»åŠ¡æ˜¯åˆ›å»ºå¹¶ç»´æŠ¤ä¸€ä¸ªå¹³è¡¡ç¨³å®šçš„å¾®å‹ç”Ÿæ€ç³»ç»Ÿã€‚é€šè¿‡ç§‘å­¦æ­é…ä¸åŒç”Ÿç‰©å’Œç²¾ç¡®è°ƒèŠ‚ç¯å¢ƒå‚æ•°ï¼Œè®©ä½ çš„ç”Ÿæ€ç“¶æˆä¸ºä¸€ä¸ªè‡ªç»™è‡ªè¶³çš„å°ä¸–ç•Œï¼</p>
                </div>
                
                <div class="tutorial-section">
                    <h3>ğŸ® æ¸¸æˆæ“ä½œæŒ‡å—</h3>
                    <ul>
                        <li><strong>é€‰æ‹©ç”Ÿç‰©ï¼š</strong>ç‚¹å‡»å·¦ä¾§ç‰©ç§å¡ç‰‡æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œäº†è§£æ¯ç§ç”Ÿç‰©çš„ç”Ÿæ€ä½œç”¨</li>
                        <li><strong>æ·»åŠ ç”Ÿç‰©ï¼š</strong>é€‰ä¸­åç‚¹å‡»"æ·»åŠ é€‰ä¸­ç”Ÿç‰©"æŒ‰é’®ï¼Œç”Ÿç‰©å°†éšæœºå‡ºç°åœ¨ç”Ÿæ€ç“¶ä¸­</li>
                        <li><strong>ç¯å¢ƒè°ƒèŠ‚ï¼š</strong>ä½¿ç”¨å…‰ç…§å’Œæ¸©åº¦æ»‘å—è°ƒèŠ‚ç¯å¢ƒæ¡ä»¶</li>
                        <li><strong>ç›‘æ§æ•°æ®ï¼š</strong>å³ä¾§é¢æ¿å®æ—¶æ˜¾ç¤ºæ°´è´¨å‚æ•°å’Œç”Ÿç‰©ç»Ÿè®¡</li>
                        <li><strong>æ—¶é—´æ§åˆ¶ï¼š</strong>å¯æš‚åœè§‚å¯Ÿæˆ–åŠ é€Ÿæ—¶é—´æµé€</li>
                    </ul>
                </div>
                
                <div class="tutorial-section">
                    <h3>ğŸ”„ ç”Ÿæ€å¹³è¡¡åŸç†</h3>
                    <ul>
                        <li><strong>ç”Ÿäº§è€…ï¼ˆæ¤ç‰©ï¼‰ï¼š</strong>åˆ©ç”¨å…‰èƒ½äº§ç”Ÿæ°§æ°”ï¼Œæ¶ˆè€—CO2å’Œè¥å…»ç›</li>
                        <li><strong>åˆçº§æ¶ˆè´¹è€…ï¼š</strong>è™¾ã€èºç­‰è‰é£ŸåŠ¨ç‰©ï¼Œæ¶ˆè€—æ¤ç‰©å’Œæœ‰æœºç‰©</li>
                        <li><strong>æ¬¡çº§æ¶ˆè´¹è€…ï¼š</strong>é±¼ç±»ç­‰è‚‰é£ŸåŠ¨ç‰©ï¼Œéœ€è¦å……è¶³æ°§æ°”</li>
                        <li><strong>åˆ†è§£è€…ï¼š</strong>ç»†èŒåˆ†è§£æ­»äº¡ç”Ÿç‰©ï¼Œé‡Šæ”¾è¥å…»ç›</li>
                        <li><strong>å…³é”®æŒ‡æ ‡ï¼š</strong>æº¶æ°§é‡ã€pHå€¼ã€è¥å…»ç›ã€æ°¨æ°®æµ“åº¦</li>
                    </ul>
                </div>
                
                <div class="tutorial-section">
                    <h3>ğŸŒ± æ–°æ‰‹æ¨èæµç¨‹</h3>
                    <p><strong>ç¬¬1æ­¥ï¼š</strong>å»ºç«‹æ¤ç‰©åŸºç¡€ - æ·»åŠ 2-3ç§ä¸åŒæ¤ç‰©ï¼ˆå¦‚ç»¿è—»ã€æ°´è‰ï¼‰</p>
                    <p><strong>ç¬¬2æ­¥ï¼š</strong>ç­‰å¾…ç¨³å®š - è§‚å¯Ÿæ¤ç‰©ç”Ÿé•¿ï¼Œæ°§æ°”ä¸Šå‡</p>
                    <p><strong>ç¬¬3æ­¥ï¼š</strong>å¼•å…¥è‰é£ŸåŠ¨ç‰© - æ·»åŠ è™¾ã€èºæ§åˆ¶è—»ç±»</p>
                    <p><strong>ç¬¬4æ­¥ï¼š</strong>ç²¾ç»†è°ƒèŠ‚ - æ ¹æ®ç”Ÿæ€æç¤ºè°ƒæ•´å‚æ•°</p>
                    <p><strong>ç¬¬5æ­¥ï¼š</strong>é«˜çº§ç”Ÿç‰© - æ¡ä»¶åˆé€‚æ—¶å¯å¼•å…¥é±¼ç±»</p>
                </div>
                
                <div class="tutorial-section">
                    <h3>âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³</h3>
                    <ul>
                        <li><strong>æ°§æ°”ä¸è¶³ï¼š</strong>å¢åŠ æ¤ç‰©æ•°é‡æˆ–æé«˜å…‰ç…§</li>
                        <li><strong>è—»ç±»çˆ†å‘ï¼š</strong>æ·»åŠ è‰é£ŸåŠ¨ç‰©æˆ–é™ä½å…‰ç…§</li>
                        <li><strong>pHå¼‚å¸¸ï¼š</strong>è°ƒæ•´ç”Ÿç‰©æ¯”ä¾‹ï¼Œå¢åŠ ç¼“å†²æ¤ç‰©</li>
                        <li><strong>æ°¨æ°®è¿‡é«˜ï¼š</strong>æ¸…ç†ç³»ç»Ÿæˆ–å¢åŠ ç¡åŒ–ç»†èŒ</li>
                    </ul>
                </div>
                
                <div class="tutorial-section">
                    <h3>ğŸ† æˆå°±ç³»ç»Ÿ</h3>
                    <p>å®Œæˆå„ç§æŒ‘æˆ˜è§£é”æˆå°±ï¼šç»´æŒé•¿æœŸå¹³è¡¡ã€åŸ¹å…»ç”Ÿç‰©å¤šæ ·æ€§ã€å¤„ç†ç”Ÿæ€å±æœºç­‰ã€‚æ¯ä¸ªæˆå°±éƒ½ä»£è¡¨ä½ åœ¨ç”Ÿæ€å­¦æ–¹é¢çš„è¿›æ­¥ï¼</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="closeTutorial()" style="padding: 15px 30px; font-size: 16px;">å¼€å§‹æˆ‘çš„ç”Ÿæ€ä¹‹æ—…</button>
            </div>
        </div>
    </div>

    <!-- ä¸»æ¸¸æˆå®¹å™¨ -->
    <div class="game-container">
        <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="game-status" id="gameStatus">ç”Ÿæ€ç³»ç»Ÿï¼šç¨³å®š</div>
            
            <div class="control-section">
                <h3>ğŸº ç”Ÿæ€ç“¶é…ç½®</h3>
                <select id="bottleSize" class="form-control" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="small">å°å‹ç“¶ (250ml) - æ–°æ‰‹æ¨è</option>
                    <option value="medium" selected>ä¸­å‹ç“¶ (500ml) - æ ‡å‡†é…ç½®</option>
                    <option value="large">å¤§å‹ç“¶ (1000ml) - ä¸“å®¶æŒ‘æˆ˜</option>
                </select>
                <div class="progress-tip">ç“¶å­å¤§å°å½±å“æœ€å¤§å®¹é‡å’Œç¯å¢ƒç¨³å®šæ€§</div>
            </div>
            
            <div class="control-section">
                <h3>ğŸ§¬ ç”Ÿç‰©ç‰©ç§åº“</h3>
                <div class="species-selector">
                    <!-- æ¤ç‰©ç±» -->
                    <div class="species-card" data-species="algae" data-category="plant">
                        <div class="species-icon">ğŸŒ±</div>
                        <div class="species-name">ç»¿è—»</div>
                    </div>
                    <div class="species-card" data-species="duckweed" data-category="plant">
                        <div class="species-icon">ğŸƒ</div>
                        <div class="species-name">æµ®è</div>
                    </div>
                    <div class="species-card" data-species="waterweed" data-category="plant">
                        <div class="species-icon">ğŸŒ¾</div>
                        <div class="species-name">æ°´è‰</div>
                    </div>
                    <div class="species-card" data-species="moss" data-category="plant">
                        <div class="species-icon">ğŸ€</div>
                        <div class="species-name">æ°´è‹”</div>
                    </div>
                    <div class="species-card" data-species="hornwort" data-category="plant">
                        <div class="species-icon">ğŸŒ¿</div>
                        <div class="species-name">é‡‘é±¼è—»</div>
                    </div>
                    <div class="species-card" data-species="lotus" data-category="plant">
                        <div class="species-icon">ğŸª·</div>
                        <div class="species-name">ç¡è²</div>
                    </div>
                    
                    <!-- æ— è„Šæ¤åŠ¨ç‰© -->
                    <div class="species-card" data-species="shrimp" data-category="herbivore">
                        <div class="species-icon">ğŸ¦</div>
                        <div class="species-name">æ¨±èŠ±è™¾</div>
                    </div>
                    <div class="species-card" data-species="snail" data-category="herbivore">
                        <div class="species-icon">ğŸŒ</div>
                        <div class="species-name">è‹¹æœèº</div>
                    </div>
                    <div class="species-card" data-species="crab" data-category="omnivore">
                        <div class="species-icon">ğŸ¦€</div>
                        <div class="species-name">å°èƒèŸ¹</div>
                    </div>
                    <div class="species-card" data-species="copepods" data-category="microorganism">
                        <div class="species-icon">ğŸ”¬</div>
                        <div class="species-name">æ¡¡è¶³ç±»</div>
                    </div>
                    <div class="species-card" data-species="daphnia" data-category="microorganism">
                        <div class="species-icon">ğŸ’§</div>
                        <div class="species-name">æ°´èš¤</div>
                    </div>
                    <div class="species-card" data-species="rotifer" data-category="microorganism">
                        <div class="species-icon">âšª</div>
                        <div class="species-name">è½®è™«</div>
                    </div>
                    
                    <!-- é±¼ç±» -->
                    <div class="species-card" data-species="fish" data-category="carnivore">
                        <div class="species-icon">ğŸŸ</div>
                        <div class="species-name">æ–‘é©¬é±¼</div>
                    </div>
                    <div class="species-card" data-species="guppy" data-category="omnivore">
                        <div class="species-icon">ğŸ </div>
                        <div class="species-name">å­”é›€é±¼</div>
                    </div>
                    <div class="species-card" data-species="betta" data-category="carnivore">
                        <div class="species-icon">ğŸ¡</div>
                        <div class="species-name">æ–—é±¼</div>
                    </div>
                    <div class="species-card" data-species="tetra" data-category="omnivore">
                        <div class="species-icon">ğŸ£</div>
                        <div class="species-name">ç¯é±¼</div>
                    </div>
                    
                    <!-- å¾®ç”Ÿç‰© -->
                    <div class="species-card" data-species="bacteria" data-category="decomposer">
                        <div class="species-icon">ğŸ¦ </div>
                        <div class="species-name">ç¡åŒ–èŒ</div>
                    </div>
                    <div class="species-card" data-species="paramecium" data-category="microorganism">
                        <div class="species-icon">ğŸ”¬</div>
                        <div class="species-name">è‰å±¥è™«</div>
                    </div>
                </div>
                
                <!-- ç‰©ç§ä¿¡æ¯æ˜¾ç¤º -->
                <div class="species-info" id="speciesInfo">
                    <div class="species-title" id="speciesTitle">
                        <span id="speciesTitleIcon">ğŸŒ±</span>
                        <span id="speciesTitleName">é€‰æ‹©ä¸€ä¸ªç‰©ç§</span>
                    </div>
                    <div class="species-role" id="speciesRole">ç‚¹å‡»å·¦ä¾§ç‰©ç§å¡ç‰‡æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</div>
                    <div class="species-stats" id="speciesStats">
                        <!-- åŠ¨æ€ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯ -->
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="addSelectedSpecies()" style="width: 100%; margin-top: 15px; padding: 12px;">
                    â• æ·»åŠ é€‰ä¸­ç”Ÿç‰©
                </button>
            </div>
            
            <div class="control-section">
                <h3>ğŸŒ ç¯å¢ƒå‚æ•°è°ƒèŠ‚</h3>
                <div class="slider-container">
                    <label>â˜€ï¸ å…‰ç…§å¼ºåº¦ - å½±å“æ¤ç‰©å…‰åˆä½œç”¨</label>
                    <input type="range" class="slider" id="lightIntensity" min="0" max="100" value="50">
                    <div class="slider-value"><span id="lightValue">50</span>% (é€‚ä¸­)</div>
                </div>
                <div class="slider-container" style="margin-top: 15px;">
                    <label>ğŸŒ¡ï¸ æ°´æ¸© - å½±å“ç”Ÿç‰©æ´»æ€§</label>
                    <input type="range" class="slider" id="temperature" min="15" max="30" value="22">
                    <div class="slider-value"><span id="tempValue">22</span>Â°C (é€‚å®œ)</div>
                </div>
            </div>
            
            <div class="control-section">
                <h3>âš¡ å¿«é€Ÿæ“ä½œ</h3>
                <button class="btn btn-warning" onclick="feedSystem()" title="æ·»åŠ è¥å…»ç‰©è´¨">
                    ğŸ½ï¸ æŠ•å–‚é£Ÿç‰©
                </button>
                <button class="btn btn-danger" onclick="cleanSystem()" title="æ¸…ç†æœ‰å®³ç‰©è´¨">
                    ğŸ§¹ æ¸…ç†ç³»ç»Ÿ
                </button>
                <button class="btn btn-primary" onclick="oxygenBoost()" title="å¢åŠ æº¶æ°§">
                    ğŸ’¨ å¢æ°§
                </button>
            </div>
            
            <!-- ç”Ÿæ€æç¤ºé¢æ¿ -->
            <div class="eco-tips">
                <div class="tips-title">
                    ğŸ’¡ ç”Ÿæ€æ™ºèƒ½æç¤º
                </div>
                <div id="ecoTipsList">
                    <div class="tip-item">
                        æ¬¢è¿æ¥åˆ°ç”Ÿæ€ç“¶ä¸–ç•Œï¼å¼€å§‹æ·»åŠ ä¸€äº›æ¤ç‰©å»ºç«‹åŸºç¡€å§ã€‚
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¸­é—´ç”Ÿæ€ç“¶æ˜¾ç¤ºåŒº -->
        <div class="bottle-area">
            <div class="bottle-container" id="bottleContainer">
                <div class="water-surface"></div>
                <div class="substrate"></div>
                <div class="algae" id="algaeLayer"></div>
            </div>
            
            <div class="time-controls">
                <button class="btn btn-primary" onclick="togglePause()">
                    <span id="pauseBtn">â¸ï¸ æš‚åœ</span>
                </button>
                <button class="btn btn-primary" onclick="changeSpeed(1)">1x</button>
                <button class="btn btn-primary" onclick="changeSpeed(2)">2x</button>
                <button class="btn btn-primary" onclick="changeSpeed(5)">5x</button>
                <div class="speed-indicator">æ—¶é—´æµé€Ÿ: <span id="speedIndicator">1x</span></div>
            </div>
            
            <div class="food-chain">
                <h4 style="margin-bottom: 10px; color: #2c3e50;">ğŸ”„ ç”Ÿæ€å¾ªç¯é“¾</h4>
                <span class="chain-node">â˜€ï¸ é˜³å…‰èƒ½</span>
                <span class="chain-arrow">â†’</span>
                <span class="chain-node">ğŸŒ± ç”Ÿäº§è€…</span>
                <span class="chain-arrow">â†’</span>
                <span class="chain-node">ğŸ¦ åˆçº§æ¶ˆè´¹è€…</span>
                <span class="chain-arrow">â†’</span>
                <span class="chain-node">ğŸŸ æ¬¡çº§æ¶ˆè´¹è€…</span>
                <span class="chain-arrow">â†’</span>
                <span class="chain-node">ğŸ¦  åˆ†è§£è€…</span>
            </div>
        </div>
        
        <!-- å³ä¾§æ•°æ®é¢æ¿ -->
        <div class="data-panel">
            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“Š å®æ—¶ç”Ÿæ€æ•°æ®</h3>
            
            <div class="parameter">
                <div class="parameter-label">ğŸ’§ æº¶è§£æ°§</div>
                <div class="parameter-value"><span id="oxygenValue">7.5</span> mg/L</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="oxygenBar" style="width: 75%; background: #3498db;"></div>
                </div>
                <div class="progress-tip">æ­£å¸¸èŒƒå›´ï¼š6-10 mg/L</div>
            </div>
            
            <div class="parameter">
                <div class="parameter-label">âš–ï¸ é…¸ç¢±åº¦</div>
                <div class="parameter-value"><span id="phValue">7.0</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="phBar" style="width: 50%; background: #2ecc71;"></div>
                </div>
                <div class="progress-tip">ç†æƒ³èŒƒå›´ï¼š6.5-7.5</div>
            </div>
            
            <div class="parameter">
                <div class="parameter-label">ğŸŒ± è¥å…»ç›</div>
                <div class="parameter-value"><span id="nutrientValue">2.5</span> mg/L</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="nutrientBar" style="width: 25%; background: #f39c12;"></div>
                </div>
                <div class="progress-tip">é€‚å®œèŒƒå›´ï¼š1-5 mg/L</div>
            </div>
            
            <div class="parameter">
                <div class="parameter-label">â˜ ï¸ æ°¨æ°®æ¯’æ€§</div>
                <div class="parameter-value"><span id="ammoniaValue">0.1</span> mg/L</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="ammoniaBar" style="width: 10%; background: #e74c3c;"></div>
                </div>
                <div class="progress-tip">å®‰å…¨ä¸Šé™ï¼š< 0.5 mg/L</div>
            </div>
            
            <div class="chart-container">
                <svg width="100%" height="100%" id="populationChart">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„ç§ç¾¤å›¾è¡¨ -->
                </svg>
            </div>
            
            <div class="control-section" style="margin-top: 20px;">
                <h3>ğŸ“ˆ ç”Ÿæ€ç»Ÿè®¡</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                    <div>è¿è¡Œæ—¶é—´: <strong><span id="gameTime">0</span></strong> å¤©</div>
                    <div>ç”Ÿç‰©æ€»æ•°: <strong><span id="totalOrganisms">0</span></strong></div>
                    <div>ç‰©ç§æ•°é‡: <strong><span id="speciesCount">0</span></strong> ç§</div>
                    <div>ç”Ÿæ€è¯„åˆ†: <strong><span id="ecoScore">100</span></strong></div>
                </div>
                
                <div style="margin-top: 15px;">
                    <h4>ğŸ† ç”Ÿæ€ç³»ç»Ÿç­‰çº§</h4>
                    <div id="ecoLevel" style="padding: 8px; background: #e8f5e8; border-radius: 5px; text-align: center; font-weight: bold; color: #2ecc71;">
                        æ–°æ‰‹ç”Ÿæ€å­¦å®¶
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- äº‹ä»¶é€šçŸ¥ -->
    <div class="event-notification" id="eventNotification">
        <div class="event-title" id="eventTitle">äº‹ä»¶æ ‡é¢˜</div>
        <div class="event-message" id="eventMessage">äº‹ä»¶æè¿°</div>
    </div>

    <!-- æˆå°±å¼¹çª— -->
    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-icon">ğŸ†</div>
        <div class="achievement-title" id="achievementTitle">æˆå°±è§£é”ï¼</div>
    </div>

    <!-- å¸®åŠ©æŒ‰é’® -->
    <div class="help-btn" onclick="showTutorial()" title="æŸ¥çœ‹æ¸¸æˆæ•™ç¨‹">?</div>

    <!-- æç¤ºå·¥å…· -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // æ‰©å±•çš„ç‰©ç§æ•°æ®åº“ - ä¿®å¤statsæ ¼å¼ç»Ÿä¸€é—®é¢˜
        const speciesDatabase = {
            // æ¤ç‰©ç±»
            algae: {
                name: 'ç»¿è—»', 
                icon: 'ğŸŒ±', 
                category: 'plant',
                role: 'å¿«é€Ÿå¢æ®–çš„åˆçº§ç”Ÿäº§è€…ï¼Œèƒ½å¤Ÿé«˜æ•ˆè¿›è¡Œå…‰åˆä½œç”¨äº§ç”Ÿæ°§æ°”ã€‚æ˜¯ç”Ÿæ€ç³»ç»Ÿçš„åŸºç¡€ï¼Œä½†è¿‡é‡ä¼šå¯¼è‡´æ°´ä½“å¯Œè¥å…»åŒ–ã€‚',
                stats: { oxygen_production: '+3', nutrient_consumption: '-2', growth_rate: 'å¿«', lifespan: 'çŸ­' },
                requirements: { light: 'medium', temperature: 'any', space: 'low' },
                effects: { oxygenBoost: 0.3, nutrientConsumption: 0.2, phEffect: -0.01 }
            },
            duckweed: {
                name: 'æµ®è', 
                icon: 'ğŸƒ', 
                category: 'plant',
                role: 'æµ®åœ¨æ°´é¢çš„æ¤ç‰©ï¼Œèƒ½å¤Ÿé®è”½é˜³å…‰å¹¶å‡€åŒ–æ°´è´¨ã€‚å¿«é€Ÿç¹æ®–ï¼Œéœ€è¦å®šæœŸæ§åˆ¶æ•°é‡ä»¥é˜²æ­¢è¿‡åº¦é®å…‰ã€‚',
                stats: { oxygen_production: '+2', shade_effect: '+2', growth_rate: 'å¾ˆå¿«', lifespan: 'ä¸­' },
                requirements: { light: 'high', temperature: 'warm', space: 'surface' },
                effects: { oxygenBoost: 0.2, lightReduction: 0.1, nutrientConsumption: 0.15 }
            },
            waterweed: {
                name: 'æ°´è‰', 
                icon: 'ğŸŒ¾', 
                category: 'plant',
                role: 'æ²‰æ°´æ¤ç‰©ï¼Œæä¾›ç¨³å®šçš„æ°§æ°”äº§å‡ºå’Œç”Ÿç‰©æ –æ¯åœ°ã€‚ç”Ÿé•¿ç¼“æ…¢ä½†å¯¿å‘½é•¿ï¼Œæ˜¯ç”Ÿæ€ç³»ç»Ÿçš„ç¨³å®šåŸºç¡€ã€‚',
                stats: { oxygen_production: '+4', shelter_provision: '+3', growth_rate: 'æ…¢', lifespan: 'é•¿' },
                requirements: { light: 'medium', temperature: 'cool', space: 'bottom' },
                effects: { oxygenBoost: 0.4, shelter: 0.3, phBuffer: 0.02 }
            },
            moss: {
                name: 'æ°´è‹”', 
                icon: 'ğŸ€', 
                category: 'plant',
                role: 'é™„ç€åœ¨åŸºè´¨ä¸Šçš„ä½ç­‰æ¤ç‰©ï¼Œèƒ½å¤Ÿå¸æ”¶è¿‡é‡è¥å…»ç›ï¼Œå…·æœ‰å¾ˆå¼ºçš„æ°´è´¨å‡€åŒ–èƒ½åŠ›ã€‚',
                stats: { purification: '+4', attachment: '+3', growth_rate: 'æ…¢', lifespan: 'å¾ˆé•¿' },
                requirements: { light: 'low', temperature: 'cool', space: 'substrate' },
                effects: { nutrientConsumption: 0.3, ammoniaReduction: 0.1, oxygenBoost: 0.1 }
            },
            hornwort: {
                name: 'é‡‘é±¼è—»', 
                icon: 'ğŸŒ¿', 
                category: 'plant',
                role: 'æ— æ ¹æ²‰æ°´æ¤ç‰©ï¼Œä¼˜ç§€çš„å¤©ç„¶è¿‡æ»¤å™¨ï¼Œèƒ½å¿«é€Ÿå¸æ”¶æ°¨æ°®å’Œå¤šä½™è¥å…»ã€‚é±¼ç±»çš„ç†æƒ³ä¼™ä¼´æ¤ç‰©ã€‚',
                stats: { filtration: '+5', oxygen_production: '+3', growth_rate: 'å¿«', lifespan: 'ä¸­' },
                requirements: { light: 'medium', temperature: 'any', space: 'water' },
                effects: { oxygenBoost: 0.3, ammoniaReduction: 0.15, nutrientConsumption: 0.25 }
            },
            lotus: {
                name: 'ç¡è²', 
                icon: 'ğŸª·', 
                category: 'plant',
                role: 'ç¾ä¸½çš„æ°´ç”ŸèŠ±å‰ï¼Œå¶ç‰‡æµ®åœ¨æ°´é¢æä¾›é®è«ï¼Œæ ¹ç³»å¼ºå¤§èƒ½ç¨³å®šæ°´è´¨ã€‚è£…é¥°æ€§ä¸åŠŸèƒ½æ€§å¹¶å­˜ã€‚',
                stats: { beauty: '+5', shade_effect: '+3', stability: '+4', lifespan: 'å¾ˆé•¿' },
                requirements: { light: 'high', temperature: 'warm', space: 'large' },
                effects: { oxygenBoost: 0.2, lightReduction: 0.15, phBuffer: 0.03, stability: 0.2 }
            },
            
            // è‰é£ŸåŠ¨ç‰©
            shrimp: {
                name: 'æ¨±èŠ±è™¾', 
                icon: 'ğŸ¦', 
                category: 'herbivore',
                role: 'ä¼˜ç§€çš„æ¸…é“å¤«ï¼Œä¸»è¦ä»¥è—»ç±»å’Œæœ‰æœºåºŸæ–™ä¸ºé£Ÿã€‚èƒ½æœ‰æ•ˆæ§åˆ¶è—»ç±»è¿‡åº¦ç¹æ®–ï¼Œç»´æŒæ°´ä½“æ¸…æ´ã€‚',
                stats: { algae_control: '-3', cleanup: '+4', reproduction: '+3', lifespan: 'ä¸­' },
                requirements: { oxygen: 'medium', temperature: 'moderate', ph: 'neutral' },
                effects: { algaeControl: 0.2, oxygenConsumption: 0.1, ammoniaProduction: 0.05, reproduction: 0.1 }
            },
            snail: {
                name: 'è‹¹æœèº', 
                icon: 'ğŸŒ', 
                category: 'herbivore',
                role: 'åº•æ –æ¸…æ´å·¥ï¼Œä»¥è…çƒ‚æ¤ç‰©å’Œè—»ç±»ä¸ºé£Ÿã€‚è¡ŒåŠ¨ç¼“æ…¢ä½†æ¸…æ´æ•ˆæœæŒä¹…ï¼Œæœ‰åŠ©äºåŸºè´¨çš„å¥åº·ã€‚',
                stats: { cleanup: '+5', algae_control: '-2', movement: '+1', lifespan: 'é•¿' },
                requirements: { oxygen: 'low', temperature: 'cool', ph: 'alkaline' },
                effects: { algaeControl: 0.1, detritivore: 0.3, oxygenConsumption: 0.05, calcification: 0.02 }
            },
            
            // æ‚é£ŸåŠ¨ç‰©
            crab: {
                name: 'å°èƒèŸ¹', 
                icon: 'ğŸ¦€', 
                category: 'omnivore',
                role: 'æ´»è·ƒçš„æ‚é£Ÿè€…ï¼Œæ—¢åƒæ¤ç‰©ä¹Ÿåƒå°åŠ¨ç‰©ã€‚å…·æœ‰ä¸€å®šçš„æ”»å‡»æ€§ï¼Œèƒ½æ§åˆ¶å…¶ä»–å°å‹ç”Ÿç‰©çš„æ•°é‡ã€‚',
                stats: { predation: '+3', cleanup: '+2', aggressiveness: '+2', lifespan: 'ä¸­' },
                requirements: { oxygen: 'medium', temperature: 'moderate', space: 'bottom' },
                effects: { predation: 0.15, scavenging: 0.2, oxygenConsumption: 0.15, ammoniaProduction: 0.08 }
            },
            guppy: {
                name: 'å­”é›€é±¼', 
                icon: 'ğŸ ', 
                category: 'omnivore',
                role: 'ç¾ä¸½çš„å°å‹çƒ­å¸¦é±¼ï¼Œé£Ÿæ€§å¹¿æ³›ã€‚ç¹æ®–èƒ½åŠ›å¼ºï¼Œèƒ½å¤Ÿåƒæ‰èšŠè™«å¹¼è™«ï¼Œä½†éœ€è¦ç¨³å®šçš„æ°´è´¨ã€‚',
                stats: { beauty: '+4', reproduction: '+5', activity: '+4', lifespan: 'ä¸­' },
                requirements: { oxygen: 'medium', temperature: 'warm', ph: 'neutral' },
                effects: { reproduction: 0.2, pestControl: 0.1, oxygenConsumption: 0.12, ammoniaProduction: 0.06 }
            },
            tetra: {
                name: 'ç¯é±¼', 
                icon: 'ğŸ£', 
                category: 'omnivore',
                role: 'ç¾¤å±…æ€§å°å‹é±¼ç±»ï¼Œæ€§æ ¼æ¸©å’Œï¼Œå–œæ¬¢åœ¨æ°´ä¸­å±‚æ¸¸åŠ¨ã€‚å¯¹æ°´è´¨è¦æ±‚ä¸é«˜ï¼Œé€‚åˆæ–°æ‰‹é¥²å…»ã€‚',
                stats: { peaceful: '+5', schooling: '+4', hardiness: '+3', lifespan: 'ä¸­' },
                requirements: { oxygen: 'medium', temperature: 'moderate', ph: 'neutral' },
                effects: { groupBonus: 0.1, oxygenConsumption: 0.1, ammoniaProduction: 0.05, stability: 0.05 }
            },
            
            // è‚‰é£ŸåŠ¨ç‰©
            fish: {
                name: 'æ–‘é©¬é±¼', 
                icon: 'ğŸŸ', 
                category: 'carnivore',
                role: 'æ´»è·ƒçš„å°å‹è‚‰é£Ÿé±¼ç±»ï¼Œä¸»è¦æ•é£Ÿæµ®æ¸¸åŠ¨ç‰©å’Œå°å‹æ— è„Šæ¤åŠ¨ç‰©ã€‚éœ€è¦è¾ƒé«˜çš„æº¶æ°§é‡å’Œæ¸…æ´çš„æ°´è´¨ã€‚',
                stats: { predation: '+4', oxygen_demand: '-3', activity: '+5', lifespan: 'ä¸­' },
                requirements: { oxygen: 'high', temperature: 'moderate', ph: 'neutral' },
                effects: { predation: 0.25, oxygenConsumption: 0.2, ammoniaProduction: 0.1, activityBoost: 0.1 }
            },
            betta: {
                name: 'æ–—é±¼', 
                icon: 'ğŸ¡', 
                category: 'carnivore',
                role: 'ç¾ä¸½ä½†å…·æœ‰æ”»å‡»æ€§çš„è‚‰é£Ÿé±¼ç±»ã€‚å•ç‹¬é¥²å…»æ•ˆæœæœ€ä½³ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæ§åˆ¶å…¶ä»–å°å‹ç”Ÿç‰©çš„æ•°é‡ã€‚',
                stats: { beauty: '+5', predation: '+5', territoriality: '+4', lifespan: 'é•¿' },
                requirements: { oxygen: 'medium', temperature: 'warm', space: 'territorial' },
                effects: { predation: 0.3, territoriality: 0.2, oxygenConsumption: 0.15, ammoniaProduction: 0.08 }
            },
            
            // å¾®ç”Ÿç‰©
            copepods: {
                name: 'æ¡¡è¶³ç±»', 
                icon: 'ğŸ”¬', 
                category: 'microorganism',
                role: 'é‡è¦çš„æµ®æ¸¸åŠ¨ç‰©ï¼Œæ˜¯é±¼ç±»çš„å¤©ç„¶é£Ÿç‰©ã€‚èƒ½å¤Ÿæ§åˆ¶æµ®æ¸¸æ¤ç‰©çš„æ•°é‡ï¼Œç»´æŒæ°´ä½“ç”Ÿæ€å¹³è¡¡ã€‚',
                stats: { food_value: '+3', plankton_control: '-2', microscopic: '+5', lifespan: 'çŸ­' },
                requirements: { oxygen: 'any', temperature: 'cool', ph: 'any' },
                effects: { foodWeb: 0.2, planktonControl: 0.15, reproduction: 0.3, bioactivity: 0.1 }
            },
            daphnia: {
                name: 'æ°´èš¤', 
                icon: 'ğŸ’§', 
                category: 'microorganism',
                role: 'é«˜æ•ˆçš„æ»¤é£Ÿæ€§æµ®æ¸¸åŠ¨ç‰©ï¼Œèƒ½å¤Ÿæ¸…é™¤æ°´ä¸­çš„ç»†èŒå’Œå°é¢—ç²’æœ‰æœºç‰©ã€‚æ˜¯å¤©ç„¶çš„æ°´è´¨å‡€åŒ–å™¨ã€‚',
                stats: { filtration: '+4', food_value: '+3', reproduction: '+4', lifespan: 'çŸ­' },
                requirements: { oxygen: 'any', temperature: 'cool', ph: 'any' },
                effects: { filtration: 0.25, foodWeb: 0.15, reproduction: 0.4, waterClarity: 0.1 }
            },
            rotifer: {
                name: 'è½®è™«', 
                icon: 'âšª', 
                category: 'microorganism',
                role: 'å¾®å°çš„å¤šç»†èƒåŠ¨ç‰©ï¼Œä»¥ç»†èŒå’Œæœ‰æœºé¢—ç²’ä¸ºé£Ÿã€‚ç¹æ®–è¿…é€Ÿï¼Œæ˜¯å°å‹é±¼ç±»å¹¼é±¼çš„ç†æƒ³å¼€å£é£Ÿç‰©ã€‚',
                stats: { microscopic: '+5', food_value: '+2', reproduction: '+5', lifespan: 'å¾ˆçŸ­' },
                requirements: { oxygen: 'low', temperature: 'any', ph: 'any' },
                effects: { microbialControl: 0.2, foodWeb: 0.1, reproduction: 0.5, bioactivity: 0.15 }
            },
            bacteria: {
                name: 'ç¡åŒ–èŒ', 
                icon: 'ğŸ¦ ', 
                category: 'decomposer',
                role: 'å…³é”®çš„åˆ†è§£è€…ï¼Œèƒ½å°†æœ‰æ¯’çš„æ°¨æ°®è½¬åŒ–ä¸ºæ— å®³çš„ç¡é…¸ç›ã€‚æ˜¯ç»´æŒæ°´è´¨å¥åº·çš„æ— åè‹±é›„ã€‚',
                stats: { detoxification: '+5', invisibility: '+5', essential: '+5', lifespan: 'æ°¸ä¹…' },
                requirements: { oxygen: 'medium', temperature: 'stable', ph: 'neutral' },
                effects: { nitrification: 0.3, ammoniaReduction: 0.25, phBuffer: 0.01, stability: 0.2 }
            },
            paramecium: {
                name: 'è‰å±¥è™«', 
                icon: 'ğŸ”¬', 
                category: 'microorganism',
                role: 'å•ç»†èƒåŸç”ŸåŠ¨ç‰©ï¼Œä»¥ç»†èŒå’Œæœ‰æœºç‰©ä¸ºé£Ÿã€‚åœ¨æ˜¾å¾®é•œä¸‹è§‚å¯Ÿï¼Œæ˜¯äº†è§£å¾®ç”Ÿç‰©ä¸–ç•Œçš„çª—å£ã€‚',
                stats: { microscopic: '+5', educational: '+3', basic: '+4', lifespan: 'å¾ˆçŸ­' },
                requirements: { oxygen: 'low', temperature: 'any', ph: 'any' },
                effects: { microbialControl: 0.15, organicDecomposition: 0.1, bioactivity: 0.2, education: 0.1 }
            }
        };

        // ç»Ÿè®¡ä¿¡æ¯ç¿»è¯‘è¡¨
        const statTranslations = {
            oxygen_production: 'äº§æ°§é‡',
            nutrient_consumption: 'è¥å…»æ¶ˆè€—',
            growth_rate: 'ç”Ÿé•¿é€Ÿåº¦',
            lifespan: 'å¯¿å‘½',
            shade_effect: 'é®å…‰æ•ˆæœ',
            shelter_provision: 'åº‡æŠ¤æä¾›',
            purification: 'å‡€åŒ–èƒ½åŠ›',
            attachment: 'é™„ç€åŠ›',
            filtration: 'è¿‡æ»¤èƒ½åŠ›',
            beauty: 'è§‚èµä»·å€¼',
            stability: 'ç¨³å®šæ€§',
            algae_control: 'è—»ç±»æ§åˆ¶',
            cleanup: 'æ¸…ç†èƒ½åŠ›',
            reproduction: 'ç¹æ®–èƒ½åŠ›',
            movement: 'ç§»åŠ¨æ€§',
            predation: 'æ•é£Ÿèƒ½åŠ›',
            aggressiveness: 'æ”»å‡»æ€§',
            activity: 'æ´»è·ƒåº¦',
            peaceful: 'æ¸©å’Œæ€§',
            schooling: 'ç¾¤å±…æ€§',
            hardiness: 'è€å—æ€§',
            oxygen_demand: 'éœ€æ°§é‡',
            territoriality: 'é¢†åŸŸæ€§',
            food_value: 'é£Ÿç‰©ä»·å€¼',
            plankton_control: 'æµ®æ¸¸æ§åˆ¶',
            microscopic: 'å¾®è§‚æ€§',
            detoxification: 'è§£æ¯’èƒ½åŠ›',
            invisibility: 'éšè”½æ€§',
            essential: 'é‡è¦æ€§',
            educational: 'æ•™è‚²ä»·å€¼',
            basic: 'åŸºç¡€æ€§'
        };

        // æ¸¸æˆæ ¸å¿ƒæ•°æ®
        const gameState = {
            isPaused: false,
            speed: 1,
            time: 0,
            bottleSize: 'medium',
            selectedSpecies: null,
            organisms: [],
            parameters: {
                oxygen: 7.5,
                ph: 7.0,
                nutrients: 2.5,
                ammonia: 0.1,
                temperature: 22,
                light: 50
            },
            populationData: {
                plants: [],
                herbivores: [],
                carnivores: [],
                microorganisms: []
            },
            achievements: {
                firstOrganism: false,
                perfectBalance: false,
                biodiversity: false,
                survivor: false,
                masterEcologist: false,
                crisisManager: false
            },
            ecoTips: [],
            lastEventTime: 0
        };

        // æ‰©å±•ç”Ÿç‰©ç±»
        class Organism {
            constructor(type, x, y) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.age = 0;
                this.health = 100;
                this.element = null;
                this.id = Date.now() + Math.random();
                this.reproductionCooldown = 0;
                this.activityLevel = Math.random();
                this.createVisual();
            }

            createVisual() {
                const elem = document.createElement('div');
                elem.className = `organism ${this.getAnimationClass()}`;
                elem.style.left = this.x + 'px';
                elem.style.bottom = this.y + 'px';
                elem.id = `organism-${this.id}`;
                
                // ä½¿ç”¨emojiå›¾æ ‡æ˜¾ç¤º
                const species = speciesDatabase[this.type];
                elem.textContent = species ? species.icon : 'â“';
                
                // æ·»åŠ æ‚¬åœæç¤º
                elem.addEventListener('mouseenter', (e) => {
                    showTooltip(e, this.getDetailedInfo());
                });
                elem.addEventListener('mouseleave', hideTooltip);
                
                // æ·»åŠ ç‚¹å‡»äº¤äº’
                elem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.interact();
                });
                
                document.getElementById('bottleContainer').appendChild(elem);
                this.element = elem;
                
                // æ ¹æ®ç‰©ç§è°ƒæ•´ä½ç½®
                this.adjustPosition();
            }

            getAnimationClass() {
                const species = speciesDatabase[this.type];
                if (!species) return 'floating-organism';
                
                switch(species.category) {
                    case 'plant':
                        return 'plant-organism';
                    case 'carnivore':
                        return this.type === 'fish' || this.type === 'betta' ? 'fish-organism' : 'floating-organism';
                    case 'herbivore':
                        return this.type === 'shrimp' ? 'shrimp-organism' : 
                               this.type === 'snail' ? 'snail-organism' : 'floating-organism';
                    case 'omnivore':
                        return this.type === 'crab' ? 'snail-organism' : 'fish-organism';
                    case 'microorganism':
                    case 'decomposer':
                        return 'floating-organism';
                    default:
                        return 'floating-organism';
                }
            }

            adjustPosition() {
                const species = speciesDatabase[this.type];
                if (!species) return;
                
                // æ ¹æ®ç”Ÿç‰©ä¹ æ€§è°ƒæ•´ä½ç½®
                if (species.category === 'plant') {
                    if (this.type === 'duckweed' || this.type === 'lotus') {
                        this.y = Math.max(400, this.y); // æ°´é¢é™„è¿‘
                    } else {
                        this.y = Math.max(60, Math.min(150, this.y)); // æ°´åº•æ¤ç‰©
                    }
                } else if (species.requirements.space === 'bottom') {
                    this.y = Math.max(60, Math.min(100, this.y)); // åº•æ –
                } else if (this.type === 'duckweed') {
                    this.y = 450; // æ°´é¢
                }
                
                this.element.style.bottom = this.y + 'px';
            }

            getDetailedInfo() {
                const species = speciesDatabase[this.type];
                if (!species) return `æœªçŸ¥ç”Ÿç‰©<br>å¥åº·åº¦: ${this.health.toFixed(1)}%<br>å¹´é¾„: ${this.age}å¤©`;
                
                return `
                    <strong>${species.name}</strong><br>
                    ${species.role.substring(0, 50)}...<br>
                    å¥åº·åº¦: ${this.health.toFixed(1)}%<br>
                    å¹´é¾„: ${this.age}å¤©<br>
                    æ´»è·ƒåº¦: ${Math.round(this.activityLevel * 100)}%<br>
                    <em>ç‚¹å‡»æŸ¥çœ‹æ›´å¤šä¿¡æ¯</em>
                `;
            }

            interact() {
                const species = speciesDatabase[this.type];
                if (species) {
                    showNotification(`${species.icon} ${species.name}`, 
                        `å¹´é¾„: ${this.age}å¤©, å¥åº·: ${this.health.toFixed(1)}%, çŠ¶æ€: ${this.getHealthStatus()}`);
                }
            }

            getHealthStatus() {
                if (this.health > 80) return 'å¥åº·';
                if (this.health > 60) return 'è‰¯å¥½';
                if (this.health > 40) return 'ä¸€èˆ¬';
                if (this.health > 20) return 'è™šå¼±';
                return 'æ¿’å±';
            }

            update() {
                this.age++;
                this.reproductionCooldown = Math.max(0, this.reproductionCooldown - 1);
                
                // æ ¹æ®ç¯å¢ƒå’Œç‰©ç§ç‰¹æ€§æ›´æ–°å¥åº·åº¦
                this.updateHealth();
                
                // ç”Ÿç‰©è¡Œä¸º
                this.behave();
                
                // æ­»äº¡æ£€æŸ¥
                if (this.health <= 0 || this.age > this.getMaxAge()) {
                    this.die();
                    return false;
                }
                
                // ç¹æ®–æ£€æŸ¥
                if (this.canReproduce()) {
                    this.tryReproduce();
                }
                
                return true;
            }

            updateHealth() {
                const species = speciesDatabase[this.type];
                if (!species) return;

                const params = gameState.parameters;
                let healthChange = 0;

                // æ°§æ°”éœ€æ±‚æ£€æŸ¥
                if (species.requirements.oxygen === 'high' && params.oxygen < 6) {
                    healthChange -= 5;
                } else if (species.requirements.oxygen === 'medium' && params.oxygen < 4) {
                    healthChange -= 3;
                }

                // æ¸©åº¦é€‚åº”æ€§
                const idealTemp = species.requirements.temperature === 'warm' ? 26 : 
                                species.requirements.temperature === 'cool' ? 18 : 22;
                const tempDiff = Math.abs(params.temperature - idealTemp);
                if (tempDiff > 5) {
                    healthChange -= tempDiff * 0.5;
                }

                // pHé€‚åº”æ€§
                if (species.requirements.ph === 'neutral') {
                    const phDiff = Math.abs(params.ph - 7);
                    healthChange -= phDiff * 2;
                }

                // è¥å…»çŠ¶å†µ
                if (species.category === 'plant' && params.nutrients < 1) {
                    healthChange -= 2;
                }

                // æ°¨æ°®æ¯’æ€§
                if (params.ammonia > 1) {
                    healthChange -= params.ammonia * 2;
                }

                // å¹´é¾„å½±å“
                const maxAge = this.getMaxAge();
                if (this.age > maxAge * 0.8) {
                    healthChange -= 1;
                }

                // åº”ç”¨å¥åº·å˜åŒ– - æ·»åŠ NaNæ£€æŸ¥
                if (!isNaN(healthChange)) {
                    this.health = Math.max(0, Math.min(100, this.health + healthChange));
                }
            }

            behave() {
                const species = speciesDatabase[this.type];
                if (!species || !species.effects) return;

                // æ¤ç‰©è¡Œä¸º
                if (species.category === 'plant') {
                    // å…‰åˆä½œç”¨äº§æ°§ - æ·»åŠ NaNæ£€æŸ¥
                    const oxygenBoost = species.effects.oxygenBoost * (gameState.parameters.light / 100);
                    if (!isNaN(oxygenBoost)) {
                        gameState.parameters.oxygen += oxygenBoost;
                    }
                    
                    // æ¶ˆè€—è¥å…»ç›
                    if (species.effects.nutrientConsumption && !isNaN(species.effects.nutrientConsumption)) {
                        gameState.parameters.nutrients -= species.effects.nutrientConsumption;
                    }
                }
                // åŠ¨ç‰©è¡Œä¸º
                else {
                    // æ¶ˆè€—æ°§æ°”
                    if (species.effects.oxygenConsumption && !isNaN(species.effects.oxygenConsumption)) {
                        gameState.parameters.oxygen -= species.effects.oxygenConsumption;
                    }
                    
                    // äº§ç”Ÿæ°¨æ°®
                    if (species.effects.ammoniaProduction && !isNaN(species.effects.ammoniaProduction)) {
                        gameState.parameters.ammonia += species.effects.ammoniaProduction;
                    }
                    
                    // è§…é£Ÿè¡Œä¸º
                    if (species.category === 'herbivore' || species.category === 'omnivore') {
                        this.feedOnAlgae();
                    }
                    if (species.category === 'carnivore' || species.category === 'omnivore') {
                        this.hunt();
                    }
                }

                // ç‰¹æ®Šæ•ˆæœ - æ·»åŠ NaNæ£€æŸ¥
                if (species.effects.ammoniaReduction && !isNaN(species.effects.ammoniaReduction)) {
                    gameState.parameters.ammonia -= species.effects.ammoniaReduction;
                }
                if (species.effects.phBuffer && !isNaN(species.effects.phBuffer)) {
                    const targetPH = 7;
                    const diff = targetPH - gameState.parameters.ph;
                    if (!isNaN(diff)) {
                        gameState.parameters.ph += diff * species.effects.phBuffer;
                    }
                }
            }

            feedOnAlgae() {
                // å¯»æ‰¾é™„è¿‘çš„è—»ç±»å¹¶ä»¥å…¶ä¸ºé£Ÿ
                const nearbyAlgae = gameState.organisms.filter(org => 
                    org.type === 'algae' && this.getDistance(org) < 50
                );
                if (nearbyAlgae.length > 0) {
                    nearbyAlgae[0].health -= 10;
                    this.health += 2;
                }
            }

            hunt() {
                // æ•é£Ÿè¾ƒå°çš„åŠ¨ç‰©
                const prey = gameState.organisms.filter(org => {
                    const species = speciesDatabase[org.type];
                    return species && species.category === 'microorganism' && 
                           this.getDistance(org) < 30;
                });
                if (prey.length > 0) {
                    prey[0].health -= 20;
                    this.health += 3;
                }
            }

            getDistance(other) {
                const dx = this.x - other.x;
                const dy = this.y - other.y;
                return Math.sqrt(dx * dx + dy * dy);
            }

            canReproduce() {
                return this.health > 70 && 
                       this.age > 20 && 
                       this.age < this.getMaxAge() * 0.7 &&
                       this.reproductionCooldown === 0;
            }

            tryReproduce() {
                const species = speciesDatabase[this.type];
                if (!species) return;

                // å¯»æ‰¾åŒç§é…å¶
                const mates = gameState.organisms.filter(org => 
                    org.type === this.type && 
                    org.id !== this.id && 
                    org.canReproduce() &&
                    this.getDistance(org) < 100
                );

                if (mates.length > 0 || species.category === 'microorganism') {
                    const reproductionChance = species.effects.reproduction || 0.05;
                    if (Math.random() < reproductionChance) {
                        this.reproduce();
                    }
                }
            }

            reproduce() {
                // æ£€æŸ¥ç¯å¢ƒå®¹é‡
                const maxOrganisms = {
                    'small': 15,
                    'medium': 25,
                    'large': 40
                };
                
                if (gameState.organisms.length >= maxOrganisms[gameState.bottleSize]) {
                    return;
                }

                // åˆ›å»ºåä»£
                const offspring = new Organism(
                    this.type,
                    this.x + (Math.random() - 0.5) * 50,
                    this.y + (Math.random() - 0.5) * 30
                );
                gameState.organisms.push(offspring);
                
                // è®¾ç½®ç¹æ®–å†·å´
                this.reproductionCooldown = 50;
                
                // é€šçŸ¥äº‹ä»¶
                const species = speciesDatabase[this.type];
                showNotification('ğŸ¥š æ–°ç”Ÿå‘½', `${species.name}æˆåŠŸç¹æ®–äº†åä»£ï¼`);
                
                // åˆ›å»ºåº†ç¥æ°”æ³¡
                createBubbles(3);
            }

            getMaxAge() {
                const species = speciesDatabase[this.type];
                const baseAges = {
                    plant: 60,
                    herbivore: 80,
                    omnivore: 90,
                    carnivore: 100,
                    microorganism: 30,
                    decomposer: 999
                };
                return baseAges[species?.category] || 50;
            }

            die() {
                if (this.element) {
                    // æ­»äº¡åŠ¨ç”»
                    this.element.style.transition = 'all 1s ease-out';
                    this.element.style.opacity = '0';
                    this.element.style.transform = 'scale(0.1)';
                    
                    setTimeout(() => {
                        if (this.element && this.element.parentNode) {
                            this.element.remove();
                        }
                    }, 1000);
                }
                
                // ä»æ¸¸æˆçŠ¶æ€ä¸­ç§»é™¤
                const index = gameState.organisms.indexOf(this);
                if (index > -1) {
                    gameState.organisms.splice(index, 1);
                }
                
                // æ­»äº¡åçš„ç¯å¢ƒå½±å“
                gameState.parameters.nutrients += 0.5;
                gameState.parameters.ammonia += 0.3;
                
                // è®°å½•æ­»äº¡äº‹ä»¶
                const species = speciesDatabase[this.type];
                if (species) {
                    showNotification('ğŸ’€ ç”Ÿå‘½ç»ˆç»“', `ä¸€åª${species.name}å¯¿ç»ˆæ­£å¯ï¼Œæˆä¸ºäº†ç”Ÿæ€å¾ªç¯çš„ä¸€éƒ¨åˆ†`);
                }
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            console.log('ğŸŒ± åˆå§‹åŒ–ç”Ÿæ€ç“¶å·¥ç¨‹å¸ˆ...');
            
            // é¦–æ¬¡è®¿é—®æ˜¾ç¤ºæ•™ç¨‹
            if (!localStorage.getItem('ecoBottleTutorial')) {
                showTutorial();
                localStorage.setItem('ecoBottleTutorial', 'true');
            }
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            setupEventListeners();
            
            // åˆå§‹åŒ–ç”Ÿæ€æç¤º
            updateEcoTips();
            
            // å¼€å§‹æ¸¸æˆå¾ªç¯
            gameLoop();
            
            // éšè—åŠ è½½ç”»é¢
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 1500);
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // ç‰©ç§é€‰æ‹©äº‹ä»¶
            document.querySelectorAll('.species-card').forEach(card => {
                card.addEventListener('click', function() {
                    // ç§»é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.species-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // è®¾ç½®é€‰ä¸­ç‰©ç§
                    gameState.selectedSpecies = this.dataset.species;
                    
                    // æ˜¾ç¤ºç‰©ç§ä¿¡æ¯
                    showSpeciesInfo(this.dataset.species);
                });
            });
            
            // ç¯å¢ƒæ§åˆ¶æ»‘å—
            document.getElementById('lightIntensity').addEventListener('input', function() {
                gameState.parameters.light = parseInt(this.value);
                document.getElementById('lightValue').textContent = this.value;
                updateLightDescription(this.value);
                updateAlgaeVisual();
                updateEcoTips();
            });
            
            document.getElementById('temperature').addEventListener('input', function() {
                gameState.parameters.temperature = parseInt(this.value);
                document.getElementById('tempValue').textContent = this.value;
                updateTemperatureDescription(this.value);
                updateEcoTips();
            });
            
            // ç“¶å­å¤§å°é€‰æ‹©
            document.getElementById('bottleSize').addEventListener('change', function() {
                gameState.bottleSize = this.value;
                updateBottleSize();
                updateEcoTips();
            });

            // å…¨å±€ç‚¹å‡»äº‹ä»¶ï¼ˆéšè—tooltipï¼‰
            document.addEventListener('click', () => {
                hideTooltip();
            });
        }

        // æ˜¾ç¤ºç‰©ç§ä¿¡æ¯
        function showSpeciesInfo(speciesType) {
            const species = speciesDatabase[speciesType];
            if (!species) return;

            const infoPanel = document.getElementById('speciesInfo');
            const titleIcon = document.getElementById('speciesTitleIcon');
            const titleName = document.getElementById('speciesTitleName');
            const roleDesc = document.getElementById('speciesRole');
            const statsContainer = document.getElementById('speciesStats');

            // æ›´æ–°åŸºæœ¬ä¿¡æ¯
            titleIcon.textContent = species.icon;
            titleName.textContent = species.name;
            roleDesc.textContent = species.role;

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ - ä¿®å¤æ˜¾ç¤ºé—®é¢˜
            statsContainer.innerHTML = '';
            Object.entries(species.stats).forEach(([key, value]) => {
                const statItem = document.createElement('div');
                statItem.className = 'stat-item';
                const translatedKey = statTranslations[key] || key;
                statItem.innerHTML = `<span>${translatedKey}</span><span>${value}</span>`;
                statsContainer.appendChild(statItem);
            });

            // æ˜¾ç¤ºä¿¡æ¯é¢æ¿
            infoPanel.classList.add('show');
        }

        // æ›´æ–°å…‰ç…§æè¿°
        function updateLightDescription(value) {
            const lightValueSpan = document.getElementById('lightValue').parentNode;
            let description = '';
            if (value < 30) description = '(ä½å…‰ç…§)';
            else if (value < 70) description = '(é€‚ä¸­)';
            else description = '(å¼ºå…‰ç…§)';
            
            lightValueSpan.innerHTML = `<span id="lightValue">${value}</span>% ${description}`;
        }

        // æ›´æ–°æ¸©åº¦æè¿°
        function updateTemperatureDescription(value) {
            const tempValueSpan = document.getElementById('tempValue').parentNode;
            let description = '';
            if (value < 20) description = '(åå†·)';
            else if (value < 25) description = '(é€‚å®œ)';
            else description = '(åçƒ­)';
            
            tempValueSpan.innerHTML = `<span id="tempValue">${value}</span>Â°C ${description}`;
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (!gameState.isPaused) {
                updateGame();
            }
            setTimeout(() => gameLoop(), 1000 / gameState.speed);
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€
        function updateGame() {
            gameState.time++;
            
            // æ›´æ–°æ‰€æœ‰ç”Ÿç‰©
            gameState.organisms = gameState.organisms.filter(organism => organism.update());
            
            // æ›´æ–°ç¯å¢ƒå‚æ•°
            updateEnvironment();
            
            // æ›´æ–°UIæ˜¾ç¤º
            updateUI();
            
            // æ£€æŸ¥éšæœºäº‹ä»¶
            if (gameState.time - gameState.lastEventTime > 100) {
                checkRandomEvents();
                gameState.lastEventTime = gameState.time;
            }
            
            // æ›´æ–°ç”Ÿæ€æç¤ºï¼ˆæ¯50ä¸ªæ—¶é—´å•ä½ï¼‰
            if (gameState.time % 50 === 0) {
                updateEcoTips();
            }
            
            // æ£€æŸ¥æˆå°±
            checkAchievements();
        }

        // æ›´æ–°ç¯å¢ƒå‚æ•° - ä¿®å¤NaNé—®é¢˜
        function updateEnvironment() {
            const params = gameState.parameters;
            
            // æ·»åŠ NaNæ£€æŸ¥å‡½æ•°
            const safeAdd = (current, change) => {
                if (isNaN(current) || isNaN(change)) return current;
                return current + change;
            };
            
            // åŸºç¡€ç¯å¢ƒå˜åŒ–
            // è‡ªç„¶æ°§æ°”æ¶ˆè€—
            params.oxygen = safeAdd(params.oxygen, -0.05);
            
            // è‡ªç„¶pHå˜åŒ–ï¼ˆè¶‹å‘ä¸­æ€§ï¼‰
            if (params.ph > 7) params.ph = safeAdd(params.ph, -0.005);
            else if (params.ph < 7) params.ph = safeAdd(params.ph, 0.005);
            
            // è¥å…»ç›çš„è‡ªç„¶åˆ†è§£
            params.nutrients = safeAdd(params.nutrients, -0.02);
            
            // æ°¨æ°®çš„è‡ªç„¶é™è§£
            params.ammonia = safeAdd(params.ammonia, -0.03);
            
            // æ¸©åº¦çš„è‡ªç„¶è°ƒèŠ‚ï¼ˆè¶‹å‘ç¯å¢ƒæ¸©åº¦ï¼‰
            const roomTemp = 22;
            const tempDiff = params.temperature - roomTemp;
            if (!isNaN(tempDiff)) {
                params.temperature = safeAdd(params.temperature, -tempDiff * 0.01);
            }
            
            // å‚æ•°è¾¹ç•Œé™åˆ¶ - ç¡®ä¿æ‰€æœ‰å€¼éƒ½æ˜¯æœ‰æ•ˆæ•°å­—
            params.oxygen = Math.max(0, Math.min(15, isNaN(params.oxygen) ? 7.5 : params.oxygen));
            params.ph = Math.max(5.5, Math.min(9.0, isNaN(params.ph) ? 7.0 : params.ph));
            params.nutrients = Math.max(0, Math.min(15, isNaN(params.nutrients) ? 2.5 : params.nutrients));
            params.ammonia = Math.max(0, Math.min(10, isNaN(params.ammonia) ? 0.1 : params.ammonia));
            params.temperature = Math.max(15, Math.min(30, isNaN(params.temperature) ? 22 : params.temperature));
        }

        // æ›´æ–°UIæ˜¾ç¤º - ç¡®ä¿æ•°å€¼æ˜¾ç¤ºæ­£ç¡®
        function updateUI() {
            // æ›´æ–°å‚æ•°æ˜¾ç¤º - æ·»åŠ NaNæ£€æŸ¥
            const safeDisplay = (value, decimals = 1) => {
                return isNaN(value) ? '0.0' : value.toFixed(decimals);
            };

            document.getElementById('oxygenValue').textContent = safeDisplay(gameState.parameters.oxygen);
            document.getElementById('phValue').textContent = safeDisplay(gameState.parameters.ph, 2);
            document.getElementById('nutrientValue').textContent = safeDisplay(gameState.parameters.nutrients);
            document.getElementById('ammoniaValue').textContent = safeDisplay(gameState.parameters.ammonia, 2);
            
            // æ›´æ–°è¿›åº¦æ¡å’Œé¢œè‰²
            updateProgressBar('oxygenBar', gameState.parameters.oxygen, 10, '#3498db', '#e74c3c');
            updateProgressBar('phBar', (gameState.parameters.ph - 5.5), 3.5, '#2ecc71', '#f39c12');
            updateProgressBar('nutrientBar', gameState.parameters.nutrients, 10, '#f39c12', '#e74c3c');
            updateProgressBar('ammoniaBar', gameState.parameters.ammonia, 5, '#95a5a6', '#e74c3c');
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('gameTime').textContent = gameState.time;
            document.getElementById('totalOrganisms').textContent = gameState.organisms.length;
            
            // ç»Ÿè®¡ç‰©ç§æ•°é‡
            const speciesTypes = new Set(gameState.organisms.map(o => o.type));
            document.getElementById('speciesCount').textContent = speciesTypes.size;
            
            // æ›´æ–°ç”Ÿæ€è¯„åˆ†
            const ecoScore = calculateEcoScore();
            document.getElementById('ecoScore').textContent = ecoScore;
            updateEcoLevel(ecoScore);
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æŒ‡ç¤ºå™¨
            updateGameStatus();
            
            // æ›´æ–°ç§ç¾¤å›¾è¡¨
            updatePopulationChart();
        }

        // æ›´æ–°è¿›åº¦æ¡ - æ·»åŠ NaNæ£€æŸ¥
        function updateProgressBar(barId, value, maxValue, normalColor, dangerColor) {
            const bar = document.getElementById(barId);
            if (!bar) return;
            
            const safeValue = isNaN(value) ? 0 : value;
            const percentage = (safeValue / maxValue) * 100;
            bar.style.width = Math.min(100, Math.max(0, percentage)) + '%';
            
            // æ ¹æ®æ•°å€¼è°ƒæ•´é¢œè‰²
            if (barId === 'oxygenBar' && safeValue < 4) {
                bar.style.background = dangerColor;
            } else if (barId === 'ammoniaBar' && safeValue > 2) {
                bar.style.background = dangerColor;
            } else if (barId === 'phBar' && (safeValue < 6.5 || safeValue > 7.5)) {
                bar.style.background = dangerColor;
            } else {
                bar.style.background = normalColor;
            }
        }

        // è®¡ç®—ç”Ÿæ€è¯„åˆ† - æ·»åŠ NaNæ£€æŸ¥
        function calculateEcoScore() {
            let score = 100;
            const params = gameState.parameters;
            
            // æ°§æ°”è¯„åˆ†
            const oxygen = isNaN(params.oxygen) ? 7.5 : params.oxygen;
            if (oxygen < 4) score -= 30;
            else if (oxygen < 6) score -= 15;
            else if (oxygen > 10) score -= 10;
            
            // pHè¯„åˆ†
            const ph = isNaN(params.ph) ? 7.0 : params.ph;
            const phDiff = Math.abs(ph - 7);
            score -= phDiff * 15;
            
            // æ°¨æ°®è¯„åˆ†
            const ammonia = isNaN(params.ammonia) ? 0.1 : params.ammonia;
            score -= ammonia * 8;
            
            // è¥å…»ç›è¯„åˆ†
            const nutrients = isNaN(params.nutrients) ? 2.5 : params.nutrients;
            if (nutrients < 0.5) score -= 10;
            else if (nutrients > 8) score -= 15;
            
            // ç”Ÿç‰©å¤šæ ·æ€§å¥–åŠ±
            const speciesCount = new Set(gameState.organisms.map(o => o.type)).size;
            score += speciesCount * 3;
            
            // ç”Ÿç‰©æ•°é‡å¹³è¡¡
            if (gameState.organisms.length > 0 && gameState.organisms.length < 5) {
                score -= 10;
            }
            
            // æ—¶é—´ç”Ÿå­˜å¥–åŠ±
            score += Math.min(20, gameState.time / 100);
            
            return Math.max(0, Math.min(100, Math.round(score)));
        }

        // æ›´æ–°ç”Ÿæ€ç³»ç»Ÿç­‰çº§
        function updateEcoLevel(score) {
            const levelElement = document.getElementById('ecoLevel');
            let level = '';
            let className = '';
            
            if (score >= 90) {
                level = 'ğŸ† ç”Ÿæ€å¤§å¸ˆ';
                className = 'eco-master';
            } else if (score >= 80) {
                level = 'ğŸ¥‡ ä¸“ä¸šç”Ÿæ€å­¦å®¶';
                className = 'eco-expert';
            } else if (score >= 70) {
                level = 'ğŸ¥ˆ ç»éªŒç”Ÿæ€å­¦å®¶';
                className = 'eco-experienced';
            } else if (score >= 60) {
                level = 'ğŸ¥‰ è¿›é˜¶ç”Ÿæ€å­¦å®¶';
                className = 'eco-advanced';
            } else if (score >= 50) {
                level = 'ğŸ“š å­¦ä¹ ç”Ÿæ€å­¦å®¶';
                className = 'eco-learning';
            } else {
                level = 'ğŸŒ± æ–°æ‰‹ç”Ÿæ€å­¦å®¶';
                className = 'eco-beginner';
            }
            
            levelElement.textContent = level;
            levelElement.className = className;
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€
        function updateGameStatus() {
            const status = document.getElementById('gameStatus');
            const score = calculateEcoScore();
            
            if (score > 80) {
                status.textContent = 'ğŸŒŸ ç”Ÿæ€ç³»ç»Ÿï¼šç¹è£ç¨³å®š';
                status.className = 'game-status';
            } else if (score > 60) {
                status.textContent = 'âš ï¸ ç”Ÿæ€ç³»ç»Ÿï¼šéœ€è¦æ³¨æ„';
                status.className = 'game-status warning';
            } else if (score > 30) {
                status.textContent = 'ğŸš¨ ç”Ÿæ€ç³»ç»Ÿï¼šé¢ä¸´é£é™©';
                status.className = 'game-status danger';
            } else {
                status.textContent = 'ğŸ’€ ç”Ÿæ€ç³»ç»Ÿï¼šæ¿’ä¸´å´©æºƒ';
                status.className = 'game-status danger';
            }
        }

        // æ›´æ–°ç”Ÿæ€æç¤º
        function updateEcoTips() {
            const tipsList = document.getElementById('ecoTipsList');
            const tips = generateEcoTips();
            
            tipsList.innerHTML = '';
            tips.forEach((tip, index) => {
                const tipElement = document.createElement('div');
                tipElement.className = 'tip-item';
                if (tip.priority === 'high') {
                    tipElement.innerHTML = `<span class="tip-priority">âš ï¸ ç´§æ€¥ï¼š</span>${tip.message}`;
                } else if (tip.priority === 'medium') {
                    tipElement.innerHTML = `<span class="tip-priority">ğŸ’¡ å»ºè®®ï¼š</span>${tip.message}`;
                } else {
                    tipElement.innerHTML = `<span class="tip-priority">â„¹ï¸ æç¤ºï¼š</span>${tip.message}`;
                }
                tipsList.appendChild(tipElement);
            });
        }

        // ç”Ÿæˆç”Ÿæ€æç¤º
        function generateEcoTips() {
            const tips = [];
            const params = gameState.parameters;
            const organismCount = gameState.organisms.length;
            const speciesTypes = new Set(gameState.organisms.map(o => o.type));
            
            // ç´§æ€¥æç¤º
            const oxygen = isNaN(params.oxygen) ? 7.5 : params.oxygen;
            const ammonia = isNaN(params.ammonia) ? 0.1 : params.ammonia;
            const ph = isNaN(params.ph) ? 7.0 : params.ph;
            
            if (oxygen < 4) {
                tips.push({
                    message: 'æº¶æ°§é‡ä¸¥é‡ä¸è¶³ï¼ç«‹å³å¢åŠ æ¤ç‰©æˆ–è°ƒé«˜å…‰ç…§å¼ºåº¦ã€‚',
                    priority: 'high'
                });
            }
            
            if (ammonia > 2) {
                tips.push({
                    message: 'æ°¨æ°®æµ“åº¦è¿‡é«˜ï¼æ¸…ç†ç³»ç»Ÿæˆ–å¢åŠ ç¡åŒ–èŒã€‚',
                    priority: 'high'
                });
            }
            
            if (ph < 6 || ph > 8) {
                tips.push({
                    message: 'pHå€¼å¼‚å¸¸ï¼è°ƒæ•´ç”Ÿç‰©é…æ¯”æˆ–ä½¿ç”¨ç¼“å†²æ¤ç‰©ã€‚',
                    priority: 'high'
                });
            }
            
            // ä¸­ç­‰å»ºè®®
            if (organismCount === 0) {
                tips.push({
                    message: 'ç”Ÿæ€ç“¶è¿˜æ˜¯ç©ºçš„ï¼Œå»ºè®®å…ˆæ·»åŠ 2-3ç§æ¤ç‰©å»ºç«‹åŸºç¡€ã€‚',
                    priority: 'medium'
                });
            } else if (organismCount < 5) {
                tips.push({
                    message: 'ç”Ÿç‰©æ•°é‡è¾ƒå°‘ï¼Œå¯ä»¥è€ƒè™‘å¢åŠ ä¸€äº›è‰é£ŸåŠ¨ç‰©ã€‚',
                    priority: 'medium'
                });
            }
            
            if (speciesTypes.size < 3 && organismCount > 0) {
                tips.push({
                    message: 'ç”Ÿç‰©å¤šæ ·æ€§ä¸è¶³ï¼Œå°è¯•æ·»åŠ ä¸åŒç±»å‹çš„ç‰©ç§ã€‚',
                    priority: 'medium'
                });
            }
            
            const plantCount = gameState.organisms.filter(o => speciesDatabase[o.type]?.category === 'plant').length;
            const animalCount = gameState.organisms.filter(o => speciesDatabase[o.type]?.category !== 'plant').length;
            
            if (plantCount === 0 && animalCount > 0) {
                tips.push({
                    message: 'ç¼ºå°‘æ¤ç‰©ï¼åŠ¨ç‰©éœ€è¦æ¤ç‰©äº§ç”Ÿçš„æ°§æ°”æ‰èƒ½ç”Ÿå­˜ã€‚',
                    priority: 'high'
                });
            }
            
            if (plantCount > 0 && animalCount === 0 && plantCount > 5) {
                tips.push({
                    message: 'æ¤ç‰©è¿‡å¤šå¯èƒ½å¯¼è‡´è¿‡åº¦ç«äº‰ï¼Œè€ƒè™‘æ·»åŠ è‰é£ŸåŠ¨ç‰©ã€‚',
                    priority: 'medium'
                });
            }
            
            // ä¸€èˆ¬æç¤º
            if (params.light < 30 && plantCount > 0) {
                tips.push({
                    message: 'å…‰ç…§è¾ƒå¼±ï¼Œæ¤ç‰©å…‰åˆä½œç”¨æ•ˆç‡ä½ï¼Œå¯é€‚å½“è°ƒé«˜å…‰ç…§ã€‚',
                    priority: 'low'
                });
            }
            
            const nutrients = isNaN(params.nutrients) ? 2.5 : params.nutrients;
            if (nutrients > 8) {
                tips.push({
                    message: 'è¥å…»ç›æµ“åº¦è¾ƒé«˜ï¼Œæ³¨æ„å¯èƒ½å¼•èµ·è—»ç±»çˆ†å‘ã€‚',
                    priority: 'low'
                });
            }
            
            if (gameState.time > 50 && calculateEcoScore() > 85) {
                tips.push({
                    message: 'ç”Ÿæ€ç³»ç»Ÿè¿è¡Œè‰¯å¥½ï¼ç»§ç»­ä¿æŒå½“å‰çš„ç®¡ç†ç­–ç•¥ã€‚',
                    priority: 'low'
                });
            }
            
            // å¦‚æœæ²¡æœ‰æç¤ºï¼Œæä¾›ä¸€èˆ¬æ€§å»ºè®®
            if (tips.length === 0) {
                const generalTips = [
                    'è§‚å¯Ÿç”Ÿç‰©è¡Œä¸ºï¼Œå®ƒä»¬ä¼šå‘Šè¯‰ä½ ç”Ÿæ€ç³»ç»Ÿçš„å¥åº·çŠ¶å†µã€‚',
                    'å¹³è¡¡æ˜¯å…³é”®ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œåˆ†è§£è€…éƒ½å¾ˆé‡è¦ã€‚',
                    'å®šæœŸç›‘æ§æ°´è´¨å‚æ•°ï¼Œé¢„é˜²é—®é¢˜æ¯”è§£å†³é—®é¢˜æ›´å®¹æ˜“ã€‚',
                    'ä¸è¦æ€¥äºæ·»åŠ å¤§å‹åŠ¨ç‰©ï¼Œå…ˆç¡®ä¿åŸºç¡€ç¯å¢ƒç¨³å®šã€‚',
                    'æ¯ç§ç”Ÿç‰©éƒ½æœ‰å…¶ç”Ÿæ€ä½ï¼Œäº†è§£å®ƒä»¬çš„éœ€æ±‚å¾ˆé‡è¦ã€‚'
                ];
                tips.push({
                    message: generalTips[Math.floor(Math.random() * generalTips.length)],
                    priority: 'low'
                });
            }
            
            return tips.slice(0, 3); // æœ€å¤šæ˜¾ç¤º3ä¸ªæç¤º
        }

        // æ·»åŠ é€‰ä¸­çš„ç‰©ç§
        function addSelectedSpecies() {
            if (!gameState.selectedSpecies) {
                showNotification('âš ï¸ æç¤º', 'è¯·å…ˆé€‰æ‹©è¦æ·»åŠ çš„ç”Ÿç‰©ç‰©ç§');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ·»åŠ 
            if (!canAddOrganism(gameState.selectedSpecies)) {
                return;
            }
            
            // éšæœºä½ç½®
            const x = Math.random() * 350 + 25;
            const y = Math.random() * 200 + 70;
            
            // åˆ›å»ºç”Ÿç‰©
            const organism = new Organism(gameState.selectedSpecies, x, y);
            gameState.organisms.push(organism);
            
            // æˆå°±æ£€æŸ¥
            if (!gameState.achievements.firstOrganism && gameState.organisms.length === 1) {
                gameState.achievements.firstOrganism = true;
                showAchievement('ğŸŒ± ç”Ÿå‘½èµ·æº', 'æˆåŠŸæ·»åŠ äº†ç¬¬ä¸€ä¸ªç”Ÿç‰©ï¼ç”Ÿæ€ä¹‹æ—…å¼€å§‹äº†');
            }
            
            // æ·»åŠ è§†è§‰æ•ˆæœ
            createBubbles(3);
            
            // æ›´æ–°æç¤º
            updateEcoTips();
            
            const species = speciesDatabase[gameState.selectedSpecies];
            showNotification('âœ… æ·»åŠ æˆåŠŸ', 
                `${species.icon} ${species.name} å·²åŠ å…¥ç”Ÿæ€ç³»ç»Ÿ`);
        }

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ·»åŠ ç”Ÿç‰©
        function canAddOrganism(type) {
            const maxOrganisms = {
                'small': 15,
                'medium': 25,
                'large': 40
            };
            
            if (gameState.organisms.length >= maxOrganisms[gameState.bottleSize]) {
                showNotification('âš ï¸ å®¹é‡é™åˆ¶', `${gameState.bottleSize}å‹ç”Ÿæ€ç“¶å·²è¾¾åˆ°æœ€å¤§å®¹é‡`);
                return false;
            }
            
            // æ£€æŸ¥ç¯å¢ƒæ¡ä»¶
            const species = speciesDatabase[type];
            if (!species) return false;
            
            const oxygen = isNaN(gameState.parameters.oxygen) ? 7.5 : gameState.parameters.oxygen;
            if (species.requirements.oxygen === 'high' && oxygen < 5) {
                showNotification('âš ï¸ ç¯å¢ƒä¸é€‚', `æ°§æ°”ä¸è¶³ï¼Œæ— æ³•æ·»åŠ ${species.name}ã€‚å…ˆæ”¹å–„æ°´è´¨å§ï¼`);
                return false;
            }
            
            if (species.category === 'carnivore' && gameState.organisms.length < 5) {
                showNotification('âš ï¸ é£Ÿç‰©ä¸è¶³', `è‚‰é£ŸåŠ¨ç‰©éœ€è¦è¶³å¤Ÿçš„é£Ÿç‰©æ¥æºï¼Œå…ˆå»ºç«‹åŸºç¡€ç”Ÿæ€å§ï¼`);
                return false;
            }
            
            return true;
        }

        // æ£€æŸ¥éšæœºäº‹ä»¶
        function checkRandomEvents() {
            const random = Math.random();
            const score = calculateEcoScore();
            
            // æ ¹æ®ç”Ÿæ€è¯„åˆ†è°ƒæ•´äº‹ä»¶æ¦‚ç‡
            let eventProbability = 0.3;
            if (score < 50) eventProbability = 0.5;
            else if (score > 80) eventProbability = 0.1;
            
            if (random < eventProbability) {
                triggerRandomEvent();
            }
        }

        // è§¦å‘éšæœºäº‹ä»¶
        function triggerRandomEvent() {
            const events = [
                {
                    condition: () => gameState.organisms.filter(o => o.type === 'algae').length > 8,
                    event: () => {
                        showNotification('ğŸŒŠ è—»ç±»çˆ†å‘', 'ç»¿è—»å¤§é‡ç¹æ®–ï¼Œæ¶ˆè€—å¤§é‡æ°§æ°”ï¼');
                        gameState.parameters.oxygen -= 3;
                        gameState.parameters.ph += 0.3;
                    }
                },
                {
                    condition: () => gameState.parameters.ammonia > 1.5,
                    event: () => {
                        showNotification('ğŸ’€ æ°´è´¨æ¶åŒ–', 'æœ‰å®³ç‰©è´¨ç§¯ç´¯ï¼Œç”Ÿç‰©å¥åº·å—å¨èƒï¼');
                        gameState.organisms.forEach(org => {
                            org.health -= Math.random() * 15;
                        });
                    }
                },
                {
                    condition: () => gameState.organisms.length > 20 && Math.random() < 0.3,
                    event: () => {
                        showNotification('ğŸ¦  ç–¾ç—…ä¼ æ’­', 'é«˜å¯†åº¦é¥²å…»å¯¼è‡´ç–¾ç—…ä¼ æ’­');
                        const affectedCount = Math.ceil(gameState.organisms.length * 0.3);
                        for (let i = 0; i < affectedCount; i++) {
                            const randomOrg = gameState.organisms[Math.floor(Math.random() * gameState.organisms.length)];
                            if (randomOrg) randomOrg.health -= 20;
                        }
                    }
                },
                {
                    condition: () => gameState.organisms.filter(o => speciesDatabase[o.type]?.category === 'plant').length > 5,
                    event: () => {
                        showNotification('ğŸŒ¸ ç”Ÿé•¿æ—ºå­£', 'æ¤ç‰©è¿›å…¥ç”Ÿé•¿æ—ºå­£ï¼Œäº§æ°§é‡å¢åŠ ï¼');
                        gameState.parameters.oxygen += 2;
                        gameState.parameters.nutrients -= 1;
                    }
                },
                {
                    condition: () => Math.random() < 0.1,
                    event: () => {
                        showNotification('ğŸŒŸ åŸºå› çªå˜', 'æŸä¸ªä¸ªä½“å‘ç”Ÿæœ‰åˆ©çªå˜ï¼Œé€‚åº”æ€§å¢å¼ºï¼');
                        if (gameState.organisms.length > 0) {
                            const luckyOne = gameState.organisms[Math.floor(Math.random() * gameState.organisms.length)];
                            luckyOne.health += 20;
                            luckyOne.activityLevel = Math.min(1, luckyOne.activityLevel + 0.2);
                        }
                    }
                }
            ];
            
            // é€‰æ‹©ç¬¦åˆæ¡ä»¶çš„äº‹ä»¶
            const possibleEvents = events.filter(e => e.condition());
            if (possibleEvents.length > 0) {
                const selectedEvent = possibleEvents[Math.floor(Math.random() * possibleEvents.length)];
                selectedEvent.event();
            }
        }

        // æ£€æŸ¥æˆå°±
        function checkAchievements() {
            const score = calculateEcoScore();
            const speciesCount = new Set(gameState.organisms.map(o => o.type)).size;
            
            // å®Œç¾å¹³è¡¡æˆå°±
            if (gameState.time > 50 && score > 90 && !gameState.achievements.perfectBalance) {
                gameState.achievements.perfectBalance = true;
                showAchievement('âš–ï¸ å®Œç¾å¹³è¡¡', 'ç»´æŒç”Ÿæ€ç³»ç»Ÿé«˜åº¦ç¨³å®š50å¤©ï¼');
            }
            
            // ç”Ÿç‰©å¤šæ ·æ€§æˆå°±
            if (speciesCount >= 8 && !gameState.achievements.biodiversity) {
                gameState.achievements.biodiversity = true;
                showAchievement('ğŸŒˆ ç”Ÿç‰©å¤šæ ·æ€§', 'åŒæ—¶åŸ¹å…»äº†8ç§ä¸åŒçš„ç”Ÿç‰©ï¼');
            }
            
            // é•¿æœŸç”Ÿå­˜æˆå°±
            if (gameState.time > 200 && gameState.organisms.length > 0 && !gameState.achievements.survivor) {
                gameState.achievements.survivor = true;
                showAchievement('â° æ—¶é—´å®ˆæŠ¤è€…', 'ç”Ÿæ€ç³»ç»Ÿè¿è¡Œè¶…è¿‡200å¤©ï¼');
            }
            
            // ç”Ÿæ€å¤§å¸ˆæˆå°±
            if (gameState.time > 100 && score > 95 && speciesCount >= 6 && !gameState.achievements.masterEcologist) {
                gameState.achievements.masterEcologist = true;
                showAchievement('ğŸ“ ç”Ÿæ€å¤§å¸ˆ', 'è¾¾æˆäº†ç”Ÿæ€å­¦å®¶çš„æœ€é«˜å¢ƒç•Œï¼');
            }
            
            // å±æœºç®¡ç†è€…æˆå°±
            if (score < 30 && gameState.organisms.length > 0) {
                // æ£€æŸ¥æ˜¯å¦ä»å±æœºä¸­æ¢å¤
                setTimeout(() => {
                    if (calculateEcoScore() > 70 && !gameState.achievements.crisisManager) {
                        gameState.achievements.crisisManager = true;
                        showAchievement('ğŸš‘ å±æœºç®¡ç†è€…', 'æˆåŠŸæ‹¯æ•‘äº†æ¿’ä¸´å´©æºƒçš„ç”Ÿæ€ç³»ç»Ÿï¼');
                    }
                }, 30000); // 30ç§’åæ£€æŸ¥
            }
        }

        // å¿«é€Ÿæ“ä½œå‡½æ•°
        function feedSystem() {
            gameState.parameters.nutrients += 2;
            showNotification('ğŸ½ï¸ æŠ•å–‚', 'å·²æ·»åŠ è¥å…»ç‰©è´¨ï¼Œæ³¨æ„ä¸è¦è¿‡é‡æŠ•å–‚');
            createBubbles(5);
            updateEcoTips();
        }

        function cleanSystem() {
            gameState.parameters.ammonia = Math.max(0, gameState.parameters.ammonia - 1.5);
            gameState.parameters.nutrients = Math.max(0, gameState.parameters.nutrients - 0.5);
            showNotification('ğŸ§¹ æ¸…ç†', 'å·²æ¸…é™¤æœ‰å®³ç‰©è´¨ï¼Œæ°´è´¨å¾—åˆ°æ”¹å–„');
            updateEcoTips();
        }

        function oxygenBoost() {
            gameState.parameters.oxygen += 2;
            showNotification('ğŸ’¨ å¢æ°§', 'äººå·¥å¢åŠ äº†æº¶è§£æ°§');
            createBubbles(8);
        }

        // æ—¶é—´æ§åˆ¶
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            document.getElementById('pauseBtn').textContent = gameState.isPaused ? 'â–¶ï¸ ç»§ç»­' : 'â¸ï¸ æš‚åœ';
        }

        function changeSpeed(speed) {
            gameState.speed = speed;
            document.getElementById('speedIndicator').textContent = speed + 'x';
        }

        // è§†è§‰æ•ˆæœ
        function createBubbles(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    bubble.style.left = Math.random() * 380 + 10 + 'px';
                    bubble.style.animationDelay = Math.random() * 2 + 's';
                    document.getElementById('bottleContainer').appendChild(bubble);
                    
                    setTimeout(() => {
                        if (bubble.parentNode) bubble.remove();
                    }, 5000);
                }, i * 100);
            }
        }

        function updateAlgaeVisual() {
            const algaeLayer = document.getElementById('algaeLayer');
            const algaeCount = gameState.organisms.filter(o => o.type === 'algae').length;
            const lightEffect = gameState.parameters.light / 100;
            const opacity = Math.min(0.7, (algaeCount * 0.08) + (lightEffect * 0.1));
            algaeLayer.style.opacity = opacity;
            
            // æ ¹æ®è—»ç±»å¯†åº¦æ”¹å˜é¢œè‰²
            if (algaeCount > 10) {
                algaeLayer.style.background = 'radial-gradient(circle at center, rgba(0, 100, 0, 0.2) 0%, transparent 70%)';
            } else {
                algaeLayer.style.background = 'radial-gradient(circle at center, rgba(0, 128, 0, 0.1) 0%, transparent 70%)';
            }
        }

        function updateBottleSize() {
            const bottle = document.getElementById('bottleContainer');
            const sizes = {
                'small': { width: 350, height: 450 },
                'medium': { width: 400, height: 500 },
                'large': { width: 450, height: 550 }
            };
            
            const size = sizes[gameState.bottleSize];
            bottle.style.width = size.width + 'px';
            bottle.style.height = size.height + 'px';
        }

        // æ•°æ®å¯è§†åŒ–
        function updatePopulationChart() {
            const chart = document.getElementById('populationChart');
            
            // ç»Ÿè®¡å„ç±»ç”Ÿç‰©æ•°é‡
            const plants = gameState.organisms.filter(o => speciesDatabase[o.type]?.category === 'plant').length;
            const herbivores = gameState.organisms.filter(o => speciesDatabase[o.type]?.category === 'herbivore').length;
            const carnivores = gameState.organisms.filter(o => ['carnivore', 'omnivore'].includes(speciesDatabase[o.type]?.category)).length;
            const microorganisms = gameState.organisms.filter(o => ['microorganism', 'decomposer'].includes(speciesDatabase[o.type]?.category)).length;
            
            // æ·»åŠ æ•°æ®ç‚¹
            gameState.populationData.plants.push(plants);
            gameState.populationData.herbivores.push(herbivores);
            gameState.populationData.carnivores.push(carnivores);
            gameState.populationData.microorganisms.push(microorganisms);
            
            // é™åˆ¶æ•°æ®é•¿åº¦
            const maxPoints = 60;
            Object.keys(gameState.populationData).forEach(key => {
                if (gameState.populationData[key].length > maxPoints) {
                    gameState.populationData[key].shift();
                }
            });
            
            // é‡ç»˜å›¾è¡¨
            redrawChart(chart);
        }

        function redrawChart(chart) {
            chart.innerHTML = '';
            
            // ç»˜åˆ¶ç½‘æ ¼
            for (let i = 0; i <= 4; i++) {
                const y = i * 30 + 10;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', '10');
                line.setAttribute('y1', y);
                line.setAttribute('x2', '320');
                line.setAttribute('y2', y);
                line.setAttribute('class', 'chart-grid');
                chart.appendChild(line);
            }
            
            // ç»˜åˆ¶æ•°æ®çº¿
            drawDataLine(chart, gameState.populationData.plants, '#2ecc71', 'æ¤ç‰©');
            drawDataLine(chart, gameState.populationData.herbivores, '#3498db', 'è‰é£Ÿ');
            drawDataLine(chart, gameState.populationData.carnivores, '#e74c3c', 'è‚‰é£Ÿ');
            drawDataLine(chart, gameState.populationData.microorganisms, '#9b59b6', 'å¾®ç”Ÿç‰©');
            
            // æ·»åŠ å›¾ä¾‹
            addChartLegend(chart);
        }

        function drawDataLine(chart, data, color, label) {
            if (data.length < 2) return;
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const maxValue = Math.max(...Object.values(gameState.populationData).flat(), 10);
            const xStep = 310 / Math.max(1, data.length - 1);
            
            let d = `M 10,${130 - (data[0] / maxValue) * 120}`;
            for (let i = 1; i < data.length; i++) {
                d += ` L ${10 + i * xStep},${130 - (data[i] / maxValue) * 120}`;
            }
            
            path.setAttribute('d', d);
            path.setAttribute('stroke', color);
            path.setAttribute('stroke-width', '2');
            path.setAttribute('fill', 'none');
            path.setAttribute('opacity', '0.8');
            
            chart.appendChild(path);
        }

        function addChartLegend(chart) {
            const legend = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            const legendData = [
                { color: '#2ecc71', label: 'æ¤ç‰©', x: 10 },
                { color: '#3498db', label: 'è‰é£Ÿ', x: 70 },
                { color: '#e74c3c', label: 'è‚‰é£Ÿ', x: 130 },
                { color: '#9b59b6', label: 'å¾®ç”Ÿç‰©', x: 190 }
            ];
            
            legendData.forEach(item => {
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', item.x);
                rect.setAttribute('y', '140');
                rect.setAttribute('width', '8');
                rect.setAttribute('height', '8');
                rect.setAttribute('fill', item.color);
                legend.appendChild(rect);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', item.x + 12);
                text.setAttribute('y', '148');
                text.setAttribute('font-size', '10');
                text.setAttribute('fill', '#333');
                text.textContent = item.label;
                legend.appendChild(text);
            });
            
            chart.appendChild(legend);
        }

        // é€šçŸ¥å’Œå¼¹çª—
        function showNotification(title, message) {
            const notification = document.getElementById('eventNotification');
            document.getElementById('eventTitle').textContent = title;
            document.getElementById('eventMessage').textContent = message;
            
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        function showAchievement(title, description) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = title;
            
            popup.classList.add('show');
            setTimeout(() => {
                popup.classList.remove('show');
            }, 5000);
            
            // åˆ›å»ºåº†ç¥æ•ˆæœ
            createBubbles(10);
        }

        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = text;
            tooltip.style.left = Math.min(event.pageX + 15, window.innerWidth - 220) + 'px';
            tooltip.style.top = Math.max(event.pageY - 60, 10) + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }

        // æ•™ç¨‹ç³»ç»Ÿ
        function showTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'flex';
        }

        function closeTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'none';
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            initGame();
            console.log('ğŸ® ç”Ÿæ€ç“¶å·¥ç¨‹å¸ˆå·²å¯åŠ¨ï¼');
        });

        // çª—å£è°ƒæ•´å¤§å°æ—¶é‡æ–°å¸ƒå±€
        window.addEventListener('resize', () => {
            hideTooltip();
        });

        // é¡µé¢å¸è½½å‰ä¿å­˜æ¸¸æˆçŠ¶æ€
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('ecoBottleGameState', JSON.stringify({
                time: gameState.time,
                achievements: gameState.achievements,
                highScore: calculateEcoScore()
            }));
        });
    </script>
</body>
</html>
