<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²¾çµå›¾åæ ‡é€‰æ‹©å·¥å…·</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #111;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        .container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
        }
        
        .left-panel {
            flex: 1;
            min-width: 600px;
        }
        
        .right-panel {
            width: 350px;
            background: #222;
            padding: 15px;
            border-radius: 8px;
            height: fit-content;
        }
        
        #imageContainer {
            position: relative;
            display: inline-block;
            border: 2px solid #333;
            background: #000;
            margin: 20px 0;
        }
        
        #spriteImage {
            display: block;
            max-width: 100%;
            cursor: crosshair;
            user-select: none;
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
        }
        
        #selectionOverlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 10;
        }
        
        .selection-box {
            position: absolute;
            border: 2px solid #ff0000;
            background: rgba(255, 0, 0, 0.2);
            pointer-events: none;
        }
        
        .info {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .sprite-item {
            background: #444;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .sprite-item:hover {
            background: #555;
        }
        
        .sprite-item.active {
            background: #0066cc;
        }
        
        .controls {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
            font-size: 12px;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .btn.danger {
            background: #f44336;
        }
        
        .btn.danger:hover {
            background: #da190b;
        }
        
        #previewCanvas {
            border: 1px solid #666;
            background: #000;
            margin: 10px 0;
        }
        
        .coordinate-display {
            background: #555;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>ğŸ® ç²¾çµå›¾åæ ‡é€‰æ‹©å·¥å…·</h1>
    
    <div class="info">
        <h3>å›¾ç‰‡åŠ è½½çŠ¶æ€ï¼š<span id="loadStatus">åŠ è½½ä¸­...</span></h3>
        <p><strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>åœ¨å›¾ç‰‡ä¸Šæ‹–æ‹½é¼ æ ‡é€‰æ‹©åŒºåŸŸï¼Œç‚¹å‡»å³ä¾§è§’è‰²åç§°åˆ‡æ¢é€‰æ‹©ç›®æ ‡</p>
    </div>
    
    <div class="container">
        <div class="left-panel">
            <div id="imageContainer">
                <img id="spriteImage" src="../assets/images/2dgamepic.png" alt="ç²¾çµå›¾">
                <canvas id="selectionOverlay"></canvas>
            </div>
            
            <div class="coordinate-display">
                <strong>å½“å‰é€‰æ‹©ï¼š</strong><span id="currentSelection">player</span><br>
                <strong>åæ ‡ï¼š</strong><span id="currentCoords">x: 0, y: 0, width: 0, height: 0</span>
            </div>
        </div>
        
        <div class="right-panel">
            <h3>ğŸ¯ é€‰æ‹©è§’è‰²ç±»å‹</h3>
            <div id="spriteList">
                <div class="sprite-item active" data-sprite="player">
                    <strong>ğŸ® ç©å®¶ (Player)</strong><br>
                    <span class="coords">x: 0, y: 0, width: 32, height: 32</span>
                </div>
                <div class="sprite-item" data-sprite="boss">
                    <strong>ğŸ‘¹ Boss</strong><br>
                    <span class="coords">x: 32, y: 0, width: 32, height: 32</span>
                </div>
                <div class="sprite-item" data-sprite="megaBoss">
                    <strong>ğŸ’€ è¶…çº§Boss</strong><br>
                    <span class="coords">x: 64, y: 0, width: 32, height: 32</span>
                </div>
                <div class="sprite-item" data-sprite="basicEnemy">
                    <strong>ğŸ‘¾ åŸºç¡€æ•Œäºº</strong><br>
                    <span class="coords">x: 96, y: 0, width: 32, height: 32</span>
                </div>
                <div class="sprite-item" data-sprite="fastEnemy">
                    <strong>âš¡ å¿«é€Ÿæ•Œäºº</strong><br>
                    <span class="coords">x: 128, y: 0, width: 32, height: 32</span>
                </div>
                <div class="sprite-item" data-sprite="tankEnemy">
                    <strong>ğŸ›¡ï¸ å¦å…‹æ•Œäºº</strong><br>
                    <span class="coords">x: 160, y: 0, width: 32, height: 32</span>
                </div>
            </div>
            
            <div class="controls">
                <h4>ğŸ”§ æ“ä½œ</h4>
                <button class="btn" onclick="exportCoordinates()">ğŸ“‹ å¯¼å‡ºåæ ‡</button>
                <button class="btn" onclick="resetAll()">ğŸ”„ é‡ç½®æ‰€æœ‰</button>
                <button class="btn danger" onclick="clearSelection()">âŒæ¸…é™¤é€‰æ‹©</button>
            </div>
            
            <div class="info">
                <h4>ğŸ“‹ é¢„è§ˆ</h4>
                <canvas id="previewCanvas" width="64" height="64"></canvas>
                <div id="previewInfo">é€‰æ‹©ä¸€ä¸ªåŒºåŸŸæŸ¥çœ‹é¢„è§ˆ</div>
            </div>
            
            <div class="info">
                <h4>ğŸ“ ç”Ÿæˆçš„ä»£ç </h4>
                <textarea id="codeOutput" style="width: 100%; height: 200px; background: #333; color: #0f0; border: 1px solid #666; font-family: monospace; font-size: 11px;" readonly></textarea>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let spriteImage = null;
        let selectionOverlay = null;
        let overlayCtx = null;
        let previewCanvas = null;
        let previewCtx = null;
        let isSelecting = false;
        let startX = 0;
        let startY = 0;
        let currentSprite = 'player';
        
        // ç²¾çµåæ ‡æ•°æ®
        let spriteCoords = {
            player: { x: 0, y: 0, width: 32, height: 32 },
            boss: { x: 32, y: 0, width: 32, height: 32 },
            megaBoss: { x: 64, y: 0, width: 32, height: 32 },
            basicEnemy: { x: 96, y: 0, width: 32, height: 32 },
            fastEnemy: { x: 128, y: 0, width: 32, height: 32 },
            tankEnemy: { x: 160, y: 0, width: 32, height: 32 }
        };
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            spriteImage = document.getElementById('spriteImage');
            selectionOverlay = document.getElementById('selectionOverlay');
            overlayCtx = selectionOverlay.getContext('2d');
            previewCanvas = document.getElementById('previewCanvas');
            previewCtx = previewCanvas.getContext('2d');
            
            setupEventListeners();
            updateCodeOutput();
        });
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            spriteImage.onload = function() {
                document.getElementById('loadStatus').textContent = 'åŠ è½½æˆåŠŸ';
                document.getElementById('loadStatus').style.color = '#00ff00';
                
                // è®¾ç½®overlay canvaså°ºå¯¸
                selectionOverlay.width = this.width;
                selectionOverlay.height = this.height;
                selectionOverlay.style.width = this.offsetWidth + 'px';
                selectionOverlay.style.height = this.offsetHeight + 'px';
                
                drawAllSelections();
            };
            
            spriteImage.onerror = function() {
                document.getElementById('loadStatus').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('loadStatus').style.color = '#ff0000';
            };

            // é˜²æ­¢å›¾ç‰‡æ‹–æ‹½
            spriteImage.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });

            spriteImage.addEventListener('selectstart', function(e) {
                e.preventDefault();
                return false;
            });

            // é¼ æ ‡äº‹ä»¶
            const imageContainer = document.getElementById('imageContainer');
            imageContainer.addEventListener('mousedown', startSelection);
            imageContainer.addEventListener('mousemove', updateSelection);
            imageContainer.addEventListener('mouseup', endSelection);
            imageContainer.addEventListener('mouseleave', endSelection);

            // å…¨å±€é¼ æ ‡äº‹ä»¶ï¼Œå¤„ç†æ‹–æ‹½åˆ°å®¹å™¨å¤–çš„æƒ…å†µ
            document.addEventListener('mousemove', function(e) {
                if (isSelecting) {
                    updateSelection(e);
                }
            });

            document.addEventListener('mouseup', function(e) {
                if (isSelecting) {
                    endSelection(e);
                }
            });

            // é˜²æ­¢å³é”®èœå•
            imageContainer.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });

            // è§’è‰²é€‰æ‹©äº‹ä»¶
            document.querySelectorAll('.sprite-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.sprite-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    currentSprite = this.dataset.sprite;
                    document.getElementById('currentSelection').textContent = currentSprite;
                    updateCurrentCoords();
                });
            });
        }

        // å¼€å§‹é€‰æ‹©
        function startSelection(e) {
            // é˜²æ­¢é»˜è®¤è¡Œä¸º
            e.preventDefault();
            e.stopPropagation();

            if (e.target !== spriteImage && e.target !== selectionOverlay) return;

            isSelecting = true;
            const rect = spriteImage.getBoundingClientRect();
            const scaleX = spriteImage.naturalWidth / spriteImage.offsetWidth;
            const scaleY = spriteImage.naturalHeight / spriteImage.offsetHeight;

            startX = (e.clientX - rect.left) * scaleX;
            startY = (e.clientY - rect.top) * scaleY;
        }

        // æ›´æ–°é€‰æ‹©
        function updateSelection(e) {
            if (!isSelecting) return;

            // é˜²æ­¢é»˜è®¤è¡Œä¸º
            e.preventDefault();
            e.stopPropagation();

            const rect = spriteImage.getBoundingClientRect();
            const scaleX = spriteImage.naturalWidth / spriteImage.offsetWidth;
            const scaleY = spriteImage.naturalHeight / spriteImage.offsetHeight;

            const currentX = (e.clientX - rect.left) * scaleX;
            const currentY = (e.clientY - rect.top) * scaleY;

            const x = Math.min(startX, currentX);
            const y = Math.min(startY, currentY);
            const width = Math.abs(currentX - startX);
            const height = Math.abs(currentY - startY);

            // æ›´æ–°å½“å‰ç²¾çµçš„åæ ‡
            spriteCoords[currentSprite] = { x: Math.round(x), y: Math.round(y), width: Math.round(width), height: Math.round(height) };

            drawAllSelections();
            updateCurrentCoords();
            updatePreview();
            updateSpriteItemCoords();
        }

        // ç»“æŸé€‰æ‹©
        function endSelection(e) {
            if (isSelecting) {
                e.preventDefault();
                e.stopPropagation();
            }
            isSelecting = false;
            updateCodeOutput();
        }

        // ç»˜åˆ¶æ‰€æœ‰é€‰æ‹©æ¡†
        function drawAllSelections() {
            overlayCtx.clearRect(0, 0, selectionOverlay.width, selectionOverlay.height);

            const scaleX = spriteImage.offsetWidth / spriteImage.naturalWidth;
            const scaleY = spriteImage.offsetHeight / spriteImage.naturalHeight;

            Object.entries(spriteCoords).forEach(([name, coords]) => {
                const x = coords.x * scaleX;
                const y = coords.y * scaleY;
                const width = coords.width * scaleX;
                const height = coords.height * scaleY;

                // è®¾ç½®é¢œè‰²
                if (name === currentSprite) {
                    overlayCtx.strokeStyle = '#ff0000';
                    overlayCtx.fillStyle = 'rgba(255, 0, 0, 0.2)';
                } else {
                    overlayCtx.strokeStyle = '#00ff00';
                    overlayCtx.fillStyle = 'rgba(0, 255, 0, 0.1)';
                }

                overlayCtx.lineWidth = 2;
                overlayCtx.fillRect(x, y, width, height);
                overlayCtx.strokeRect(x, y, width, height);

                // ç»˜åˆ¶æ ‡ç­¾
                overlayCtx.fillStyle = name === currentSprite ? '#ff0000' : '#00ff00';
                overlayCtx.font = '12px Arial';
                overlayCtx.fillText(name, x + 2, y - 5);
            });
        }

        // æ›´æ–°å½“å‰åæ ‡æ˜¾ç¤º
        function updateCurrentCoords() {
            const coords = spriteCoords[currentSprite];
            document.getElementById('currentCoords').textContent =
                `x: ${coords.x}, y: ${coords.y}, width: ${coords.width}, height: ${coords.height}`;
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            if (!spriteImage.complete) return;

            const coords = spriteCoords[currentSprite];
            previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);

            if (coords.width > 0 && coords.height > 0) {
                previewCtx.drawImage(
                    spriteImage,
                    coords.x, coords.y, coords.width, coords.height,
                    0, 0, previewCanvas.width, previewCanvas.height
                );
                document.getElementById('previewInfo').textContent = `${currentSprite} é¢„è§ˆ`;
            }
        }

        // æ›´æ–°ç²¾çµé¡¹ç›®çš„åæ ‡æ˜¾ç¤º
        function updateSpriteItemCoords() {
            document.querySelectorAll('.sprite-item').forEach(item => {
                const spriteName = item.dataset.sprite;
                const coords = spriteCoords[spriteName];
                const coordsSpan = item.querySelector('.coords');
                coordsSpan.textContent = `x: ${coords.x}, y: ${coords.y}, width: ${coords.width}, height: ${coords.height}`;
            });
        }

        // æ›´æ–°ä»£ç è¾“å‡º
        function updateCodeOutput() {
            const output = `const spriteCoords = {\n${Object.entries(spriteCoords).map(([name, coords]) =>
                `    ${name}: { x: ${coords.x}, y: ${coords.y}, width: ${coords.width}, height: ${coords.height} }`
            ).join(',\n')}\n};`;

            document.getElementById('codeOutput').value = output;
        }

        // å¯¼å‡ºåæ ‡
        function exportCoordinates() {
            const output = document.getElementById('codeOutput').value;
            navigator.clipboard.writeText(output).then(() => {
                alert('åæ ‡ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸè¿›è¡Œå¤åˆ¶
                const textarea = document.createElement('textarea');
                textarea.value = output;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('åæ ‡ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        // é‡ç½®æ‰€æœ‰
        function resetAll() {
            spriteCoords = {
                player: { x: 0, y: 0, width: 32, height: 32 },
                boss: { x: 32, y: 0, width: 32, height: 32 },
                megaBoss: { x: 64, y: 0, width: 32, height: 32 },
                basicEnemy: { x: 96, y: 0, width: 32, height: 32 },
                fastEnemy: { x: 128, y: 0, width: 32, height: 32 },
                tankEnemy: { x: 160, y: 0, width: 32, height: 32 }
            };
            drawAllSelections();
            updateCurrentCoords();
            updatePreview();
            updateSpriteItemCoords();
            updateCodeOutput();
        }

        // æ¸…é™¤å½“å‰é€‰æ‹©
        function clearSelection() {
            spriteCoords[currentSprite] = { x: 0, y: 0, width: 0, height: 0 };
            drawAllSelections();
            updateCurrentCoords();
            updatePreview();
            updateSpriteItemCoords();
            updateCodeOutput();
        }
    </script>
</body>
</html>
